# MISSÃO DE CORREÇÃO: Conectar o Visualizador de Documentos ao Caminho Correto no Storage

**Contexto:** Olá, Agente. A nossa funcionalidade de upload de documentos está a funcionar perfeitamente! Os ficheiros estão a ser salvos no Supabase Storage, dentro de pastas organizadas pelo ID da proposta, exatamente como planeado. No entanto, a parte de visualização está quebrada.

**O Problema (Sintoma):**
Quando o Analista está na tela de "Analisar Proposta" e clica no botão "Visualizar" de um documento, ele não consegue ver o ficheiro. O sistema não está a conseguir construir o caminho correto para buscar o documento dentro da pasta específica da sua proposta no nosso bucket `documents`, que é um bucket privado.

**Sua Missão (A Solução):**
A sua tarefa é refatorar o nosso backend e frontend para que o botão "Visualizar" funcione.

**Roadmap de Execução:**

1.  **Backend (Gerar URLs de Acesso Seguras):**
    * **A Causa Provável:** O nosso backend provavelmente está a enviar apenas o nome do ficheiro para o frontend, mas como o nosso bucket é **privado**, o frontend não tem permissão para aceder diretamente.
    * **Sua Tarefa:** Modifique o nosso endpoint que busca os detalhes de uma proposta (provavelmente `GET /api/propostas/:id`). Para cada documento associado à proposta, ele não deve retornar apenas o nome do ficheiro, mas sim uma **URL de acesso assinada e temporária**. Utilize a função `createSignedUrl` do cliente de storage do Supabase para gerar estas URLs.

2.  **Frontend (Consumir as URLs Seguras):**
    * **Sua Tarefa:** No nosso componente da página de "Analisar Proposta" (provavelmente `/client/src/pages/credito/analise.tsx`), garanta que o componente `DocumentViewer` receba esta nova URL assinada e a utilize para exibir o documento no `<iframe>` ou no visualizador.

**Resumo da Missão:**
Faça com que, ao abrir os detalhes de uma proposta, a lista de documentos seja enriquecida com URLs de acesso seguras e temporárias, e que o botão "Visualizar" use estas URLs para exibir os ficheiros corretamente.