# MISSÃO DE CORREÇÃO: Finalizar o "Ciclo de Pendência" do Atendente

**Contexto:** Olá, Agente. O nosso fluxo de análise de propostas está 90% funcional. Um analista já consegue "pendenciar" uma proposta e ela volta corretamente para o atendente. Agora, precisamos de consertar o que acontece a seguir.

**O Problema (O Que Está Quebrado):**
Quando o `ATENDENTE` está na tela de correção de uma proposta que foi pendenciada, os botões "Salvar Alterações" e "Reenviar para Análise" estão a falhar com um erro. Ele não consegue devolver a proposta corrigida para o analista.

**Sua Missão (O Fluxo Correto):**
A sua tarefa é refatorar o nosso backend para permitir que o atendente complete o ciclo, garantindo que todas as ações sejam registadas no histórico.

**Roadmap de Execução:**

**1. Corrija a Permissão no Backend:**
* **A Causa Provável:** O erro atual é provavelmente um problema de permissão. A nossa API (`PUT /api/propostas/:id/status`) não deve estar a permitir que um `ATENDENTE` faça esta mudança de status.
* **Sua Tarefa:** Modifique as permissões (o "role-guard") do endpoint `PUT /api/propostas/:id/status`. A nova regra deve ser: um `ATENDENTE` pode, **especificamente e somente**, alterar uma proposta do status `'pendente'` para `'aguardando_analise'`. As outras mudanças de status (`aprovar`, `negar`) continuam a ser exclusivas do `ANALISTA` e do `ADMINISTRADOR`.

**2. Garanta a Atualização do Histórico:**
* **O Requisito:** Quando o `ATENDENTE` reenvia a proposta, esta ação e as suas observações precisam de ser registadas para que o analista as veja.
* **Sua Tarefa:** Garanta que, quando o `ATENDENTE` executa a ação de reenviar a proposta, um novo registo seja criado na tabela `proposta_logs` com a sua observação, o `autor_id` correto e a mudança de status (`pendente` -> `aguardando_analise`).

**Resumo da Missão:**
Faça com que o botão "Reenviar para Análise" do atendente funcione, atualizando o status da proposta para `aguardando_analise` e registando a ação no histórico.