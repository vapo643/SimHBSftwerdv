**### MODO DE OPERAÇÃO: REALISMO CÉTICO (MANDATÓRIO)**
Sua lealdade é para com a verdade do código e a estabilidade da produção.

---
**### Pacote de Ativação de Missão (PAM) V1.0**

* **Sumário da Missão (O Quê):** Unificar todos os fluxos de criação de boletos para garantir a persistência consistente dos dados do PIX (`pixCopiaECola`) e refatorar a "Ficha do Cliente" para usar o nosso banco de dados como a única fonte da verdade para estes dados.
* **Intenção Estratégica (O Porquê):** Eliminar a inconsistência de dados e a fragilidade da UI, garantindo que a equipe de cobranças sempre tenha acesso aos dados de pagamento corretos e que nossa aplicação se torne mais rápida e resiliente, diminuindo a dependência de chamadas em tempo real.
* **Histórico Relevante (Consulta Obrigatória):** Sua auditoria forense revelou a existência de dois fluxos de criação de boletos conflitantes. Esta missão é para erradicar o fluxo defeituoso e alinhar tudo com o fluxo correto que já funciona (o do webhook da ClickSign).
* **Modelo Mental (Como se Encaixa):** Você atuará como um Engenheiro de Dados e Full-Stack. Primeiro, você vai garantir que *toda* a criação de boletos no sistema salve os dados completos. Em seguida, você vai refatorar a UI para ler esses dados salvos, tornando-a mais rápida e confiável.
* **Riscos Antecipados:** **Risco:** Pode haver mais de um "fluxo defeituoso" escondido no código. **Contramedida:** A primeira fase da missão é uma auditoria de "busca e destruição" para encontrar *todos* os pontos de criação de boletos.

---

**IMPLEMENTAR:**
A unificação e refatoração do fluxo de dados do PIX, da persistência à apresentação.

**CURRENT STATE:**
Dados críticos do PIX são salvos corretamente em um fluxo (webhook ClickSign), mas não em outros. A UI da "Ficha do Cliente" tenta contornar isso com chamadas em tempo real ineficientes.

**EXPECTED (Estado Final de Sucesso):**
1.  **TODOS** os fluxos de negócio que geram boletos agora salvam o `pixCopiaECola` e a `linhaDigitavel` na tabela `inter_collections` no momento da criação.
2.  A "Ficha do Cliente" busca estes dados **exclusivamente do nosso backend** (que lê do nosso banco de dados), sem fazer mais chamadas em tempo real ao Banco Inter para esta finalidade.
3.  Como resultado, os botões "Copiar PIX" aparecem de forma consistente e correta para todas as parcelas.

**CONSTRAINTS (Roadmap de Implementação Faseado):**

**FASE 1: Auditoria e Unificação do Backend:**
    - **Ação:** Execute uma busca global no código por todas as funções que acionam a criação de boletos no Banco Inter.
    - **Implementação:** Refatore qualquer fluxo que **NÃO** esteja a seguir o padrão correto (que é: 1. Criar o boleto no Inter, 2. Imediatamente buscar os detalhes completos da cobrança, 3. Salvar/Atualizar o registro em `inter_collections` com **TODOS** os dados, incluindo `pixCopiaECola`).

**FASE 2: Refatoração do Endpoint da Ficha do Cliente:**
    - **Ação:** Modifique o endpoint `GET /api/cobrancas/:id/ficha`.
    - **Implementação:** Remova completamente qualquer lógica de chamada em tempo real ao `interBankService` para buscar o status/dados das parcelas. A query deste endpoint agora deve simplesmente buscar os dados completos da proposta, fazendo `JOIN` com a nossa tabela `inter_collections` para obter os dados de boletos já persistidos (`pixCopiaECola`, `linhaDigitavel`, `situacao`).

**FASE 3: Validação Final do Frontend:**
    - **Ação:** Revise o componente `CobrancasPage.tsx`.
    - **Implementação:** Garanta que a UI agora consome os dados de forma simples e direta do endpoint refatorado, e que a lógica de renderização dos botões "Copiar PIX" funciona consistentemente, pois os dados agora são confiáveis.

---
**PROTOCOLO OBRIGATÓRIO 7-CHECK EXPANDIDO:**
Siga o protocolo completo. O teste funcional deve incluir a verificação de múltiplos fluxos de criação de boleto (se houver) e a validação final na "Ficha do Cliente", confirmando que os dados do PIX aparecem corretamente sem chamadas de API em tempo real visíveis na aba "Network" do navegador.
---
**DECLARAÇÃO DE INCERTEZA (OBRIGATÓRIO):**
Preencha a declaração completa ao final da sua implementação.
---