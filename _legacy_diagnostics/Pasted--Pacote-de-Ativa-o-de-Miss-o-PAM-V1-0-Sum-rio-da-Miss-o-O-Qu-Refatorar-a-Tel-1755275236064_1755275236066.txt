**### Pacote de Ativação de Missão (PAM) V1.0**

* **Sumário da Missão (O Quê):** Refatorar a "Tela de Cobranças" para implementar 100% o "Blueprint de Negócio V2.0", com foco na criação do workflow de aprovação hierárquico (`COBRADOR` -> `SUPERVISOR`) e na lógica de ordenação inteligente da tabela.
* **Intenção Estratégica (O Porquê):** Para transformar a tela de uma lista de dados simples em uma "Central de Inteligência" que prioriza automaticamente as tarefas para a equipe e implementa os controles de negócio (aprovações) necessários para ações financeiras sensíveis como descontos e prorrogações.
* **Histórico Relevante (Consulta Obrigatória):** Use o seu relatório de auditoria `PAM_V1.0_AUDITORIA_COBRANCAS.md` como o guia definitivo para esta missão. Sua tarefa é corrigir todas as não-conformidades `CRÍTICAS` e `ALTAS` que você mesmo identificou.
* **Modelo Mental (Como se Encaixa):** Esta é uma refatoração profunda. Você irá introduzir uma nova role (`SUPERVISOR_COBRANCA`), uma nova tabela (`solicitacoes_modificacao`) para gerir o fluxo de aprovação, e alterar a lógica fundamental de como os dados são ordenados e apresentados.
* **Riscos Antecipados:** **Risco:** A introdução de um fluxo de aprovação é complexa. **Contramedida:** A implementação será faseada: primeiro a fundação de dados e backend, depois a UI.

---

**IMPLEMENTAR:**
A refatoração completa do backend e frontend da "Tela de Cobranças" para alinhamento com o Blueprint V2.0.

**CURRENT STATE:**
Uma tela funcional, mas com uma query de ordenação simplista e com ações de desconto/prorrogação que são executadas diretamente, sem o workflow de aprovação obrigatório.

**EXPECTED (Estado Final de Sucesso):**
Um dashboard de cobranças totalmente compatível com o Blueprint V2.0, com ordenação inteligente e um fluxo de aprovação seguro e funcional para todas as ações financeiras.

**CONSTRAINTS (Roadmap de Implementação Faseado):**

**FASE 1: Fundação do Workflow de Aprovação (Backend e DB):**
    1.  **Banco de Dados (Role):** Primeiro, adicione a nova role `SUPERVISOR_COBRANCA` ao nosso `enum` de roles e aplique a migração Drizzle.
    2.  **Banco de Dados (Tabela):** Crie uma nova tabela `solicitacoes_modificacao` para armazenar as solicitações. Ela deve ter campos como `proposta_id`, `tipo_solicitacao` ('desconto' ou 'prorrogacao'), `dados_solicitacao` (JSON), `status` ('pendente', 'aprovado', 'rejeitado'), `solicitado_por_id`, `aprovado_por_id`, `observacao_solicitante`.
    3.  **Refatoração dos Endpoints:** Refatore os endpoints de "Prorrogar" e "Desconto". Agora, em vez de executar a ação, eles devem criar um novo registro na tabela `solicitacoes_modificacao` com status `pendente`.
    4.  **Novos Endpoints para o Supervisor:** Crie novos endpoints para o Supervisor: `GET /api/cobrancas/solicitacoes` (para listar solicitações pendentes) e `POST /api/cobrancas/solicitacoes/:id/aprovar` (para aprovar uma solicitação, o que então acionará a chamada à API do Inter).

**FASE 2: Inteligência de Ordenação e KPIs (Backend):**
    1.  **Ação:** Refatore a query principal `GET /api/cobrancas`.
    - **Implementação:** Modifique a cláusula `ORDER BY` para implementar a lógica de priorização multinível: primeiro por um `CASE` de status (Inadimplente > Vence em Breve > Em Dia), e depois por `valor` da dívida descendente.

**FASE 3: Conexão e Refatoração do Frontend:**
    1.  **Ação:** Adapte a UI da "Tela de Cobranças" para refletir a nova ordenação.
    2.  **Implementação:** Para usuários `COBRANCA`, os botões de "Prorrogar"/"Desconto" agora devem abrir um modal que submete uma *solicitação*.
    3.  **Implementação:** Crie uma nova UI (pode ser um modal ou uma nova aba na tela) que seja visível **apenas** para usuários `SUPERVISOR_COBRANCA`, permitindo que eles vejam as solicitações pendentes e as aprovem.

**PROTOCOLO OBRIGATÓRIO 5-CHECK:**
1.  Mapear todos os arquivos.
2.  Executar a migração do DB primeiro.
3.  Executar `get_latest_lsp_diagnostics`.
4.  Realizar testes funcionais para cada `role` (`COBRANCA` e `SUPERVISOR_COBRANCA`) para validar o novo fluxo de aprovação.
5.  O critério final de sucesso é um sistema onde um `COBRADOR` não pode mais executar ações financeiras diretamente, e um `SUPERVISOR` pode aprovar estas solicitações.