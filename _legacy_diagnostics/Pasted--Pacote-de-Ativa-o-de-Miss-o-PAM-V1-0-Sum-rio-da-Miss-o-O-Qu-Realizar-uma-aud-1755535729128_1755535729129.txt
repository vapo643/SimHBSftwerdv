**### Pacote de Ativação de Missão (PAM) V1.0**

* **Sumário da Missão (O Quê):** Realizar uma auditoria forense completa da "Ficha do Cliente" para identificar as causas raiz de três falhas críticas: status de parcela incorreto, falha de autenticação no download de PDF e falha na função "Marcar como Pago".
* **Intenção Estratégica (O Porquê):** O Arquiteto identificou uma falha sistêmica que torna a Ficha do Cliente inoperável e não confiável. Antes de qualquer correção, precisamos de um diagnóstico 100% preciso para cada um dos três bugs.
* **Histórico Relevante (Consulta Obrigatória):** A sua última implementação (`CORRECAO-UI-FICHA-CLIENTE-COBRANCAS-01`) introduziu estas regressões. Sua análise deve focar no código que você modificou ou adicionou.
* **Modelo Mental (Como se Encaixa):** Você é um Engenheiro de Qualidade Sênior a realizar uma Análise de Causa Raiz (RCA). Sua tarefa é ler, analisar e relatar, não modificar.
* **Riscos Antecipados:** **Risco:** Uma análise superficial nos manterá neste loop de erro. **Contramedida:** Sua missão não é resolver, mas sim **PROVAR**, com evidências de código, onde está cada falha.

---

**IMPLEMENTAR:**
Um relatório de auditoria detalhado. **NÃO FAÇA MODIFICAÇÕES.**

**CURRENT STATE:**
A "Ficha do Cliente" está com três bugs críticos que a tornam inutilizável.

**EXPECTED (Estado Final de Sucesso):**
Um relatório de auditoria que responda a todas as questões abaixo.

**CONSTRAINTS (Roadmap de Auditoria Forense):**

**1. Auditoria do Bug de Status "Pago" Incorreto:**
    * **Ação:** Inspecione o endpoint `GET /api/cobrancas/:propostaId/ficha` e o componente de frontend que renderiza o status da parcela.
    * **Relatório:** Qual é a **fonte da verdade** para o status da parcela? É um dado mockado? Um fallback incorreto? A query do backend está a buscar o status corretamente da tabela `inter_collections`? Apresente a linha de código exata que define o status exibido na UI.

**2. Auditoria do Erro "Token de acesso requerido" no Download:**
    * **Ação:** Inspecione a lógica `onClick` do botão de download de boletos individuais na Ficha do Cliente (`CobrancasPage.tsx`).
    * **Relatório:** A chamada de API para `/api/inter/collections/.../pdf` está a ser feita através do nosso wrapper de API (`apiRequest`) que anexa o token JWT automaticamente, ou está a usar uma chamada `fetch` ou `window.open` direta que **não inclui o header de autorização**? Apresente o trecho de código da chamada de API.

**3. Auditoria da Falha "Marcar como Pago":**
    * **Ação:** Inspecione a `mutation` do TanStack Query no frontend que chama o endpoint `PATCH /api/cobrancas/parcelas/:codigoSolicitacao/marcar-pago` e a lógica deste endpoint no backend.
    * **Relatório:** Rastreie o fluxo de dados. O frontend está a enviar os parâmetros corretos? O backend está a receber a requisição? Qual é a mensagem de erro exata que a API retorna quando a ação falha? (Verifique a aba "Network" das ferramentas de desenvolvedor).