# MISSÃO DE IMPLEMENTAÇÃO: Conectar e Proteger a "Fila de Formalização"

**Contexto:** Olá, Agente. O nosso sistema de segurança está estável. A nossa próxima missão é construir a próxima etapa do nosso funil: a "Fila de Formalização".

**O Problema (Estado Atual):**
Atualmente, a página de "Formalização" está desatualizada e a exibir dados fictícios ("mock data").

**Sua Missão (O Fluxo Correto):**
A sua tarefa é conectar esta tela aos dados reais, implementando a lógica de negócio e as permissões corretas.

**ROADMAP DE EXECUÇÃO (Sequencial):**

**1. Backend (Atualize a Segurança RLS - O Passo Mais Importante):**
* **A Nova Regra de Negócio:** Precisamos de uma nova regra de permissão. Os `ATENDENTES` precisam de aceder à tela de Formalização, mas eles só podem ver as propostas que **eles mesmos criaram** e que foram aprovadas.
* **Sua Tarefa:** Modifique a nossa política de **Row Level Security (RLS)** na tabela `propostas`. Adicione à política de `SELECT` uma condição que permita que um `ATENDENTE` veja uma proposta se o `status` dela estiver na lista de formalização (ex: `aprovado`, `documentos_enviados`, etc.) **E** se o `autor_id` da proposta for igual ao `id` do `ATENDENTE` logado (`auth.uid()`).

**2. Backend (Crie/Ajuste o Endpoint):**
* **Tarefa:** Crie ou ajuste o endpoint `GET /api/propostas/formalizacao`. A sua lógica deve fazer uma query à tabela `propostas` e retornar todas as propostas cujo `status` esteja na lista de formalização. O RLS que você implementou no passo 1 irá garantir automaticamente que cada usuário só receba os dados que tem permissão para ver.

**3. Frontend (Conecte a UI):**
* **Tarefa:** Refatore o componente da página de "Formalização" (provavelmente `/client/src/pages/formalizacao.tsx`). Remova os dados "mock" e use o `useQuery` e o nosso `apiClient` para chamar o novo endpoint e exibir os dados reais na tabela.

**Resumo da Missão:**
Ao final, a "Fila de Formalização" deve exibir propostas reais, e um `ATENDENTE` logado deve ver apenas as suas próprias propostas que foram aprovadas.