
> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

[INTER] 🏦 Initialized in production mode
[INTER] 🌐 API URL: https://cdpj.partners.bancointer.com.br
[CLICKSIGN V1] 🚀 Initialized in PRODUCTION mode (legal signatures)
[CLICKSIGN V1] API URL: https://app.clicksign.com/api/v1
[CLICKSIGN V1] Token configured: b73b3b90-c...
🚀 [TIMING MIDDLEWARE] Creating middleware instance...
🚀 [TIMING MIDDLEWARE] Middleware instance created and exported
12:23:46 PM [express] ✅ All secrets loaded successfully
12:23:46 PM [express] 🔒 [SECURITY] CORS protection configured - ASVS V13.2.1
12:23:46 PM [express] 🔧 [DEV] CSP disabled in development mode for debugging
12:23:46 PM [express] 🔒 [SECURITY] Input sanitization middleware activated
12:23:46 PM [express] 🔒 [SECURITY] URL token validation middleware activated - ASVS V7.1.1
12:23:46 PM [express] 🔒 [SECURITY] CSRF protection middleware activated - OWASP Cheat Sheet
12:23:46 PM [express] 🔧 [DEV] Rate limiting configurado para desenvolvimento - limites altos
[SEMGREP MCP] Development mode - using in-memory cache
🧠 [ML] Treinando modelo de detecção...
12:23:47 PM [express] 🔐 Security WebSocket initialized
12:23:47 PM [express] ℹ️  Security monitoring disabled. Set ENABLE_SECURITY_MONITORING=true to enable
12:23:47 PM [express] 🔧 App Config Status:
12:23:47 PM [express]   - Port: 5000
12:23:47 PM [express]   - Environment: development
12:23:47 PM [express]   - Database: ✅ Connected
12:23:47 PM [express]   - Supabase: ✅ Connected
12:23:47 PM [express]   - Security: Rate Limit ✅, Helmet ✅
12:23:47 PM [express] 🚀 Server running on port 5000
12:23:47 PM [express] 🌍 Environment: development
12:23:47 PM [express] 📦 Checking storage buckets...
Browserslist: browsers data (caniuse-lite) is 10 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
12:23:50 PM [express] ✅ Storage bucket "documents" already exists as PRIVATE
✅ [ML] Modelo treinado com 0 amostras
🔐 JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-05T12:28:03.633Z'
}
🔐 JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-05T12:28:13.989Z'
}
🔐 JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-05T12:28:13.997Z'
}
🔐 JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-05T12:28:14.041Z'
}
[2025-08-05T09:28:14.000-03:00] 🔍 INICIO - Buscando dados de formalização para proposta: 902183dd-b5d1-4e20-8a72-79d3d3559d4d
[2025-08-05T09:28:14.000-03:00] 🔍 STEP 1 - Fazendo query direta no Supabase...
[INTER COLLECTIONS] Fetching collections for proposal: 902183dd-b5d1-4e20-8a72-79d3d3559d4d
[INTER] 📋 Retrieving collection: a108e29d-c53e-4a9e-9f52-868a72eb0165
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: e3c68ed7-7402-49bc-ae66-2d3adec83275
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: 222e3b63-333d-478a-b571-693af12869b6
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: ef1472b8-876a-4d0b-a575-a3aed7cbf362
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: e01209d8-7263-448b-b5f7-2376892fdfd7
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: 07886b5c-a96a-4e26-badf-a942e1d9c547
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: 4019b9db-dc32-4a16-884b-237a0424e87e
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: 44a467d1-e93f-4e91-b1f9-c79438ef5eea
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: 06f3888f-c067-494a-a619-18d14bc59d8a
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: 54d85ce0-979d-4c7f-872a-f903513fae01
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: c7e7d3a3-0d1a-496c-a600-27c4794fab2c
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: a3f3986e-4e47-4c1b-b436-d3eb21ef01c9
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: 72c6bff2-f928-4946-ba7a-e4a347cc584c
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[INTER] 📋 Retrieving collection: f05af659-0abe-48bc-872f-c550ea096b2e
[INTER] 🔑 Requesting new access token...
[INTER] 🌐 Token URL: cdpj.partners.bancointer.com.br/oauth/v2/token
[INTER] 📄 Using form-based authentication per official docs
[INTER] 🔓 Certificate configured: ✅ Present
[INTER] 🔑 Private Key configured: ✅ Present
[INTER] 📊 Client ID length: 36 chars
[INTER] 📊 Client Secret length: 36 chars
[INTER] 📝 Form parameters: client_id=***, grant_type=client_credentials, scope=boleto-cobranca.read boleto-cobranca.write webhook.read webhook.write
[INTER] 📝 Form body string length: 203 chars
[INTER] 📝 Form body preview: client_id=05fc3816-9a8f-4a2d-8b28-277cd3617cc2&client_secret=bbb82b01-2ca0-407f-a21c-0e1dff659d42&gr...
[INTER] 🔒 Using mTLS certificate authentication
[INTER] 🔄 Formatting certificates with proper line breaks...
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] ✅ Certificate formatted with line breaks
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] ✅ Private key formatted with line breaks
[INTER] ✅ Certificates formatted and ready
[INTER] 🔧 Creating Undici agent for mTLS...
[INTER] 🚀 Making mTLS request with Undici agent...
[2025-08-05T09:28:14.000-03:00] 🔍 STEP 2 - Proposta encontrada: true
[2025-08-05T09:28:14.000-03:00] 🔍 STEP 2.1 - Dados da proposta: {
  id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
  status: 'pronto_pagamento',
  tabela_comercial_id: 16,
  produto_id: 3,
  atendente_id: undefined
}
[2025-08-05T09:28:14.000-03:00] 🔍 STEP 3 - Buscando documentos...
🔐 JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-05T12:28:15.108Z'
}
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[2025-08-05T09:28:15.000-03:00] 🔍 STEP 4 - Documentos encontrados: 1
[2025-08-05T09:28:15.000-03:00] 🔍 STEP 4.1 - Estrutura dos documentos: [
  {
    id: 11,
    proposta_id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
    nome_arquivo: 'WalkingSkeletonMvp - Replit - Google Chrome 16_07_2025 09_21_37.png',
    url: 'https://dvglgxrvhmtsixaabxha.supabase.co/storage/v1/object/sign/documents/proposta-902183dd-b5d1-4e20-8a72-79d3d3559d4d/1754064515626-WalkingSkeletonMvp%20-%20Replit%20-%20Google%20Chrome%2016_07_2025%2009_21_37.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV80OTVlMjJjYS1lMDMxLTQ0Y2YtOTM3Zi03N2M3ZWNiMTk2YzkiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJkb2N1bWVudHMvcHJvcG9zdGEtOTAyMTgzZGQtYjVkMS00ZTIwLThhNzItNzlkM2QzNTU5ZDRkLzE3NTQwNjQ1MTU2MjYtV2Fsa2luZ1NrZWxldG9uTXZwIC0gUmVwbGl0IC0gR29vZ2xlIENocm9tZSAxNl8wN18yMDI1IDA5XzIxXzM3LnBuZyIsImlhdCI6MTc1NDA2NDUxOSwiZXhwIjoxNzU0MDY4MTE5fQ.vy9PR-FS4OfuXoTuNLEstla4LgD57ZdTt1RhNZbvSCM',
    tamanho: 0,
    tipo: 'image/png',
    created_at: '2025-08-01T16:08:39.611456'
  }
]
[2025-08-05T09:28:15.000-03:00] 🔍 STEP 4.2 - Gerando URLs assinadas para 1 documentos...
🔍 [FORMALIZAÇÃO] Tentando gerar URL para documento: {
  nome: 'WalkingSkeletonMvp - Replit - Google Chrome 16_07_2025 09_21_37.png',
  url: 'https://dvglgxrvhmtsixaabxha.supabase.co/storage/v1/object/sign/documents/proposta-902183dd-b5d1-4e20-8a72-79d3d3559d4d/1754064515626-WalkingSkeletonMvp%20-%20Replit%20-%20Google%20Chrome%2016_07_2025%2009_21_37.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV80OTVlMjJjYS1lMDMxLTQ0Y2YtOTM3Zi03N2M3ZWNiMTk2YzkiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJkb2N1bWVudHMvcHJvcG9zdGEtOTAyMTgzZGQtYjVkMS00ZTIwLThhNzItNzlkM2QzNTU5ZDRkLzE3NTQwNjQ1MTU2MjYtV2Fsa2luZ1NrZWxldG9uTXZwIC0gUmVwbGl0IC0gR29vZ2xlIENocm9tZSAxNl8wN18yMDI1IDA5XzIxXzM3LnBuZyIsImlhdCI6MTc1NDA2NDUxOSwiZXhwIjoxNzU0MDY4MTE5fQ.vy9PR-FS4OfuXoTuNLEstla4LgD57ZdTt1RhNZbvSCM',
  tipo: 'image/png',
  proposta_id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d'
}
🔍 [FORMALIZAÇÃO] Caminho extraído para URL assinada: proposta-902183dd-b5d1-4e20-8a72-79d3d3559d4d/1754064515626-WalkingSkeletonMvp%20-%20Replit%20-%20Google%20Chrome%2016_07_2025%2009_21_37.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV80OTVlMjJjYS1lMDMxLTQ0Y2YtOTM3Zi03N2M3ZWNiMTk2YzkiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJkb2N1bWVudHMvcHJvcG9zdGEtOTAyMTgzZGQtYjVkMS00ZTIwLThhNzItNzlkM2QzNTU5ZDRkLzE3NTQwNjQ1MTU2MjYtV2Fsa2luZ1NrZWxldG9uTXZwIC0gUmVwbGl0IC0gR29vZ2xlIENocm9tZSAxNl8wN18yMDI1IDA5XzIxXzM3LnBuZyIsImlhdCI6MTc1NDA2NDUxOSwiZXhwIjoxNzU0MDY4MTE5fQ.vy9PR-FS4OfuXoTuNLEstla4LgD57ZdTt1RhNZbvSCM
[INTER] ❌ Fetch error: fetch failed
[INTER] 🔄 Falling back to raw HTTPS request...
[INTER] 📡 Response status: 200
[INTER] ✅ Access token obtained successfully (expires in 3600s)
[INTER] ========== REQUEST DETAILS ==========
[INTER] 🌐 FULL URL: https://cdpj.partners.bancointer.com.br/cobranca/v3/cobrancas/a108e29d-c53e-4a9e-9f52-868a72eb0165
[INTER] 🔧 METHOD: GET
[INTER] 🪙 TOKEN (first 20 chars):', 022593d3-0ca5-4a69-8...
[INTER] ===================================
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] 🏦 CONTA CORRENTE HEADER ADDED: 346470536
[INTER] 🔑 ALL HEADERS: {
  "Authorization": "Bearer 022593d3-0ca5-4a69-87ef-d8829a96a461",
  "Accept": "application/json",
  "User-Agent": "SIMPIX-Inter-Integration/1.0",
  "x-conta-corrente": "346470536"
}
[INTER] 📡 Response status: 200
[INTER] ✅ Access token obtained successfully (expires in 3600s)
[INTER] ========== REQUEST DETAILS ==========
[INTER] 🌐 FULL URL: https://cdpj.partners.bancointer.com.br/cobranca/v3/cobrancas/e3c68ed7-7402-49bc-ae66-2d3adec83275
[INTER] 🔧 METHOD: GET
[INTER] 🪙 TOKEN (first 20 chars):', 9b82b7d8-5365-4167-9...
[INTER] ===================================
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] 🏦 CONTA CORRENTE HEADER ADDED: 346470536
[INTER] 🔑 ALL HEADERS: {
  "Authorization": "Bearer 9b82b7d8-5365-4167-9aa3-2f2d81652bad",
  "Accept": "application/json",
  "User-Agent": "SIMPIX-Inter-Integration/1.0",
  "x-conta-corrente": "346470536"
}
[INTER] 📡 Response status: 200
[INTER] ✅ Access token obtained successfully (expires in 3600s)
[INTER] ========== REQUEST DETAILS ==========
[INTER] 🌐 FULL URL: https://cdpj.partners.bancointer.com.br/cobranca/v3/cobrancas/222e3b63-333d-478a-b571-693af12869b6
[INTER] 🔧 METHOD: GET
[INTER] 🪙 TOKEN (first 20 chars):', 5dcb4d5a-9850-4624-b...
[INTER] ===================================
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] 🏦 CONTA CORRENTE HEADER ADDED: 346470536
[INTER] 🔑 ALL HEADERS: {
  "Authorization": "Bearer 5dcb4d5a-9850-4624-b632-9c7426f731e7",
  "Accept": "application/json",
  "User-Agent": "SIMPIX-Inter-Integration/1.0",
  "x-conta-corrente": "346470536"
}
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 8)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/06f3888f-c067-494a-a619-18d14bc59d8a: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 8)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 8)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for 06f3888f-c067-494a-a619-18d14bc59d8a: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 8)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 5)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/07886b5c-a96a-4e26-badf-a942e1d9c547: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 5)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 5)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for 07886b5c-a96a-4e26-badf-a942e1d9c547: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 5)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 3)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/ef1472b8-876a-4d0b-a575-a3aed7cbf362: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 3)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 3)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for ef1472b8-876a-4d0b-a575-a3aed7cbf362: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 3)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] 📡 Response status: 200
[INTER] ✅ Access token obtained successfully (expires in 3600s)
[INTER] ========== REQUEST DETAILS ==========
[INTER] 🌐 FULL URL: https://cdpj.partners.bancointer.com.br/cobranca/v3/cobrancas/e01209d8-7263-448b-b5f7-2376892fdfd7
[INTER] 🔧 METHOD: GET
[INTER] 🪙 TOKEN (first 20 chars):', e57089b5-998f-4b4a-a...
[INTER] ===================================
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] 🏦 CONTA CORRENTE HEADER ADDED: 346470536
[INTER] 🔑 ALL HEADERS: {
  "Authorization": "Bearer e57089b5-998f-4b4a-aa42-ae0f72530374",
  "Accept": "application/json",
  "User-Agent": "SIMPIX-Inter-Integration/1.0",
  "x-conta-corrente": "346470536"
}
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 7)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/44a467d1-e93f-4e91-b1f9-c79438ef5eea: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 7)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 7)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for 44a467d1-e93f-4e91-b1f9-c79438ef5eea: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 7)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 9)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/54d85ce0-979d-4c7f-872a-f903513fae01: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 9)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 9)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for 54d85ce0-979d-4c7f-872a-f903513fae01: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 9)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 12)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/72c6bff2-f928-4946-ba7a-e4a347cc584c: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 12)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 12)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for 72c6bff2-f928-4946-ba7a-e4a347cc584c: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 12)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 10)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/c7e7d3a3-0d1a-496c-a600-27c4794fab2c: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 10)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 10)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for c7e7d3a3-0d1a-496c-a600-27c4794fab2c: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 10)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] 📡 Response status: 200
[INTER] ✅ Access token obtained successfully (expires in 3600s)
[INTER] ========== REQUEST DETAILS ==========
[INTER] 🌐 FULL URL: https://cdpj.partners.bancointer.com.br/cobranca/v3/cobrancas/4019b9db-dc32-4a16-884b-237a0424e87e
[INTER] 🔧 METHOD: GET
[INTER] 🪙 TOKEN (first 20 chars):', 81ba2f31-7d30-4728-8...
[INTER] ===================================
[INTER] 📋 Certificate is single-line PEM, adding line breaks...
[INTER] 🔑 Private key is single-line PEM, adding line breaks...
[INTER] 🏦 CONTA CORRENTE HEADER ADDED: 346470536
[INTER] 🔑 ALL HEADERS: {
  "Authorization": "Bearer 81ba2f31-7d30-4728-81f8-379fb0559479",
  "Accept": "application/json",
  "User-Agent": "SIMPIX-Inter-Integration/1.0",
  "x-conta-corrente": "346470536"
}
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 13)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/f05af659-0abe-48bc-872f-c550ea096b2e: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 13)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 13)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for f05af659-0abe-48bc-872f-c550ea096b2e: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 13)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[2025-08-05T09:28:15.000-03:00] ✅ URL gerada para documento: WalkingSkeletonMvp - Replit - Google Chrome 16_07_2025 09_21_37.png
[2025-08-05T09:28:15.000-03:00] 🔍 STEP 5 - Verificando tabela_comercial_id: 16
[2025-08-05T09:28:15.000-03:00] 🔍 STEP 5.1 - Buscando tabela comercial ID: 16
[INTER] 📡 Response status: 429
[INTER] ❌ Error response body: 
[INTER] ❌ Error response is not JSON
[INTER] ❌ Failed to get access token: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 11)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] Request failed for /cobranca/v3/cobrancas/a3f3986e-4e47-4c1b-b436-d3eb21ef01c9: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 11)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER] ❌ Failed to retrieve collection: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 11)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[INTER COLLECTIONS] Error fetching details for a3f3986e-4e47-4c1b-b436-d3eb21ef01c9: Error: Token request failed: 429 - 
    at InterBankService.getAccessToken (/home/runner/workspace/server/services/interBankService.ts:367:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async InterBankService.makeRequest (/home/runner/workspace/server/services/interBankService.ts:393:21)
    at async InterBankService.recuperarCobranca (/home/runner/workspace/server/services/interBankService.ts:608:24)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:35:29)
    at async Promise.all (index 11)
    at async <anonymous> (/home/runner/workspace/server/routes/inter-collections.ts:32:34)
[2025-08-05T09:28:16.000-03:00] 🔍 STEP 5.2 - Resultado da consulta tabela comercial: {
  data: { taxa_juros: 19.7, nome_tabela: 'Flex', parceiro_id: null },
  error: undefined,
  hasData: true
}
[2025-08-05T09:28:16.000-03:00] ✅ Taxa de juros encontrada: 19.7 % da tabela "Flex"
[2025-08-05T09:28:16.000-03:00] 🔍 STEP 6 - Processando dados JSONB...
[2025-08-05T09:28:16.000-03:00] ✅ SUCESSO - Dados de formalização retornados para proposta 902183dd-b5d1-4e20-8a72-79d3d3559d4d: {
  id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
  status: 'pronto_pagamento',
  ccbGerado: true,
  dataAprovacao: '2025-08-01T13:21:55',
  temClienteData: true,
  temCondicoesData: true,
  totalDocumentos: 1,
  clienteNome: 'Gabriel de Jesus Santana Serri',
  valorEmprestimo: 1000,
  taxaJuros: 19.7
}
[INTER] ========== RESPONSE DETAILS ==========
[INTER] 📊 STATUS: 200 OK
[INTER] 📋 RESPONSE HEADERS: {
  'content-type': 'application/json',
  date: 'Tue, 5 Aug 2025 12:28:16 GMT',
  server: 'istio-envoy',
  'strict-transport-security': 'max-age=31536000; includeSubDomains',
  traceparent: '00-3038b66d678f7e24233475348d871c0b-136772407f374068-00',
  'x-envoy-upstream-service-time': '65',
  'x-rate-limit-remaining': '119',
  'x-rate-limit-time': '1754396956165',
  'x-upstream-time': '82',
  'content-length': '1173'
}
[INTER] ✅ Response OK
[INTER] =====================================
[INTER] ✅ Collection retrieved successfully
[INTER] ========== RESPONSE DETAILS ==========
[INTER] 📊 STATUS: 200 OK
[INTER] 📋 RESPONSE HEADERS: {
  'content-type': 'application/json',
  date: 'Tue, 5 Aug 2025 12:28:16 GMT',
  server: 'istio-envoy',
  'strict-transport-security': 'max-age=31536000; includeSubDomains',
  traceparent: '00-2fe089547b03f3c56ca2d92d99500b5d-b75466c6b782f311-00',
  'x-envoy-upstream-service-time': '84',
  'x-rate-limit-remaining': '119',
  'x-rate-limit-time': '1754396956161',
  'x-upstream-time': '107',
  'content-length': '1173'
}
[INTER] ✅ Response OK
[INTER] =====================================
[INTER] ✅ Collection retrieved successfully
[INTER] ========== RESPONSE DETAILS ==========
[INTER] 📊 STATUS: 200 OK
[INTER] 📋 RESPONSE HEADERS: {
  'content-type': 'application/json',
  date: 'Tue, 5 Aug 2025 12:28:16 GMT',
  server: 'istio-envoy',
  'strict-transport-security': 'max-age=31536000; includeSubDomains',
  traceparent: '00-fd133f32c3d77ffd10383b9ab5895e8c-a4effc65aff302ca-01',
  'x-envoy-upstream-service-time': '154',
  'x-rate-limit-remaining': '119',
  'x-rate-limit-time': '1754396956147',
  'x-upstream-time': '156',
  'content-length': '1173'
}
[INTER] ✅ Response OK
[INTER] =====================================
[INTER] ✅ Collection retrieved successfully
[INTER] ========== RESPONSE DETAILS ==========
[INTER] 📊 STATUS: 200 OK
[INTER] 📋 RESPONSE HEADERS: {
  'content-type': 'application/json',
  date: 'Tue, 5 Aug 2025 12:28:16 GMT',
  server: 'istio-envoy',
  'strict-transport-security': 'max-age=31536000; includeSubDomains',
  traceparent: '00-4717a3b2ec4509e4ec363647edf49e6b-155bb66f5a14bb42-00',
  'x-envoy-upstream-service-time': '98',
  'x-rate-limit-remaining': '119',
  'x-rate-limit-time': '1754396956229',
  'x-upstream-time': '101',
  'content-length': '1173'
}
[INTER] ✅ Response OK
[INTER] =====================================
[INTER] ✅ Collection retrieved successfully
[INTER] ========== RESPONSE DETAILS ==========
[INTER] 📊 STATUS: 200 OK
[INTER] 📋 RESPONSE HEADERS: {
  'content-type': 'application/json',
  date: 'Tue, 5 Aug 2025 12:28:16 GMT',
  server: 'istio-envoy',
  'strict-transport-security': 'max-age=31536000; includeSubDomains',
  traceparent: '00-7b76e92a4c01329cdd1971e43b7bc46d-64034c4a11600798-00',
  'x-envoy-upstream-service-time': '215',
  'x-rate-limit-remaining': '119',
  'x-rate-limit-time': '1754396956247',
  'x-upstream-time': '221',
  'content-length': '1173'
}
[INTER] ✅ Response OK
[INTER] =====================================
[INTER] ✅ Collection retrieved successfully
🔐 JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-05T12:28:16.943Z'
}
[DEBUG] Gerando URL assinada para: proposta-902183dd-b5d1-4e20-8a72-79d3d3559d4d/1754064515626-WalkingSkeletonMvp%20-%20Replit%20-%20Google%20Chrome%2016_07_2025%2009_21_37.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV80OTVlMjJjYS1lMDMxLTQ0Y2YtOTM3Zi03N2M3ZWNiMTk2YzkiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJkb2N1bWVudHMvcHJvcG9zdGEtOTAyMTgzZGQtYjVkMS00ZTIwLThhNzItNzlkM2QzNTU5ZDRkLzE3NTQwNjQ1MTU2MjYtV2Fsa2luZ1NrZWxldG9uTXZwIC0gUmVwbGl0IC0gR29vZ2xlIENocm9tZSAxNl8wN18yMDI1IDA5XzIxXzM3LnBuZyIsImlhdCI6MTc1NDA2NDUxOSwiZXhwIjoxNzU0MDY4MTE5fQ.vy9PR-FS4OfuXoTuNLEstla4LgD57ZdTt1RhNZbvSCM
^A