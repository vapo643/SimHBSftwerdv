# MISSÃO: Re-arquitetar a Funcionalidade de Exclusão de Produtos (Hard Delete com Salvaguardas)

**CONTEXTO ESTRATÉGICO:**
A nossa regra de negócio para a exclusão de produtos foi alterada. A ação de "Excluir" na tela de "Gestão de Produtos" deve agora executar uma **exclusão permanente (hard delete)** do registro no banco de dados, em vez de uma simples desativação.

**AÇÃO:**
Sua missão é refatorar o backend e o frontend para implementar este novo comportamento, incluindo uma salvaguarda crítica para proteger a integridade dos dados.

**ROADMAP DE EXECUÇÃO (Sequencial):**

---
**PASSO 1: Refatoração do Backend (`DELETE /api/produtos/:id`)**

* **Ficheiro Alvo:** O controlador ou a rota que lida com a exclusão de produtos (provavelmente `/server/controllers/produtoController.ts` ou `/server/routes.ts`).
* **Tarefa:** Substitua a lógica de "soft delete" (`UPDATE ... SET is_active = false`) pela seguinte lógica de "hard delete" com verificação de dependência:

    1.  **Verificação de Dependências:** Antes de qualquer outra coisa, execute uma query no banco de dados para verificar se existe algum registro na tabela `tabelas_comerciais` que utilize o `produto_id` do produto que está a ser excluído.
    2.  **Lógica Condicional:**
        * **SE** a verificação encontrar alguma dependência (a contagem for > 0), a exclusão deve ser **BLOQUEADA**. A API deve retornar um status de erro **`409 Conflict`** com a mensagem clara: "Este produto não pode ser excluído pois está a ser utilizado por uma ou mais Tabelas Comerciais."
        * **SE** a verificação não encontrar nenhuma dependência, a API deve então executar o comando de exclusão permanente: `DELETE FROM produtos WHERE id = ...`.
    3.  **Resposta de Sucesso:** Após a exclusão bem-sucedida, a API deve retornar um status `204 No Content`.

---
**PASSO 2: Refinamento do Frontend (Aviso de Risco na UI)**

* **Ficheiro Alvo:** O componente da página "Gestão de Produtos" (provavelmente `/client/src/pages/configuracoes/produtos.tsx`).
* **Tarefa:** Modifique o modal de confirmação que aparece ao clicar no botão "Excluir".
* **Requisito:** O texto dentro do modal deve ser alterado para um aviso inequívoco sobre a natureza da ação. Por exemplo:

    > **"Tem a certeza?**
    > **Esta ação é irreversível e irá apagar permanentemente o produto do banco de dados. Esta operação só será bem-sucedida se o produto não estiver associado a nenhuma Tabela Comercial."**

---
Execute este plano para implementar a nova política de exclusão.