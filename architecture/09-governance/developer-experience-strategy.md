# Estrat√©gia de Ambiente de Desenvolvimento Local (Developer Experience)

**Status:** Proposto  
**Data:** 22/08/2025  
**Autor:** GEM-02 Dev Specialist  
**Tipo:** Documento Estrat√©gico  
**Criticidade:** P0 - Cr√≠tica para Produtividade da Equipe

---

## üìã Sum√°rio Executivo

Este documento estabelece a estrat√©gia mandat√≥ria para padroniza√ß√£o do ambiente de desenvolvimento local do sistema Simpix, focando em eliminar inconsist√™ncias entre ambientes, acelerar o onboarding de desenvolvedores e maximizar a produtividade da equipe atrav√©s de uma Developer Experience (DX) de excel√™ncia.

---

## üéØ 1. Decis√£o

**Adotaremos o padr√£o Dev Containers (usando `devcontainer.json`) como nossa estrat√©gia mandat√≥ria para padroniza√ß√£o do ambiente de desenvolvimento local, complementado por automa√ß√£o via Make/Task e documenta√ß√£o interativa.**

### Declara√ß√£o Formal
```
PADR√ÉO OBRIGAT√ìRIO: Dev Containers + VS Code
ENFORCEMENT: Verifica√ß√£o autom√°tica em CI/CD
APLICA√á√ÉO: Imediata para novos desenvolvedores
MIGRA√á√ÉO: Progressiva para equipe existente (30 dias)
```

---

## üîç 2. Justificativa

### 2.1 Problemas Atuais (An√°lise Forense)

| Problema | Impacto | Frequ√™ncia |
|----------|---------|------------|
| "Funciona na minha m√°quina" | Alto - Atrasos em deploys | Di√°rio |
| Onboarding lento (2-3 dias) | Alto - Perda de produtividade | Por contrata√ß√£o |
| Vers√µes inconsistentes de Node/DB | Cr√≠tico - Bugs em produ√ß√£o | Semanal |
| Configura√ß√£o manual de secrets | M√©dio - Riscos de seguran√ßa | Por desenvolvedor |
| Depend√™ncias externas n√£o mockadas | Alto - Bloqueios em desenvolvimento | Di√°rio |

### 2.2 Benef√≠cios da Solu√ß√£o

1. **Reprodutibilidade Total:** Ambiente id√™ntico para todos os desenvolvedores
2. **Onboarding em < 30 minutos:** Setup automatizado com um clique
3. **Isolamento de Depend√™ncias:** Containers garantem vers√µes consistentes
4. **Seguran√ßa por Design:** Secrets gerenciados centralmente
5. **Produtividade Aumentada:** Foco em c√≥digo, n√£o em configura√ß√£o

### 2.3 An√°lise Comparativa

| Solu√ß√£o | Pr√≥s | Contras | Decis√£o |
|---------|------|---------|---------|
| **Dev Containers** | Padroniza√ß√£o total, integra√ß√£o VS Code, reprodut√≠vel | Requer Docker | ‚úÖ ESCOLHIDA |
| Vagrant | Multiplataforma | Pesado, lento | ‚ùå |
| Docker Compose apenas | Flex√≠vel | Sem integra√ß√£o IDE | ‚ùå |
| Scripts bash | Simples | N√£o reprodut√≠vel | ‚ùå |

---

## üõ†Ô∏è 3. Ferramentas Padronizadas

### 3.1 Stack Base do Container

```dockerfile
# Base image
FROM mcr.microsoft.com/devcontainers/typescript-node:1-20-bullseye

# Vers√µes mandat√≥rias
NODE_VERSION=20.11.0
PNPM_VERSION=8.15.0
POSTGRESQL_VERSION=15
REDIS_VERSION=7.2
```

### 3.2 Ferramentas de Desenvolvimento

| Categoria | Ferramenta | Vers√£o | Justificativa |
|-----------|------------|--------|---------------|
| **Runtime** | Node.js | 20.11.0 LTS | Estabilidade e performance |
| **Package Manager** | pnpm | 8.15.0 | Efici√™ncia de espa√ßo |
| **Database** | PostgreSQL | 15 | Compat√≠vel com Supabase |
| **Cache** | Redis | 7.2 | Para BullMQ |
| **ORM CLI** | Drizzle Kit | latest | Migrations |
| **API Testing** | Bruno | latest | Substituir Postman |
| **Shell** | zsh + oh-my-zsh | latest | Produtividade |
| **Git Hooks** | Husky | 9.0.0 | Qualidade de c√≥digo |
| **Linting** | ESLint + Prettier | latest | Padroniza√ß√£o |

### 3.3 Extens√µes VS Code Obrigat√≥rias

```json
{
  "extensions": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "prisma.prisma",
    "bradlc.vscode-tailwindcss",
    "streetsidesoftware.code-spell-checker",
    "streetsidesoftware.code-spell-checker-portuguese-brazilian",
    "eamodio.gitlens",
    "usernamehw.errorlens",
    "yoavbls.pretty-ts-errors",
    "orta.vscode-jest",
    "ms-vscode.vscode-typescript-next"
  ]
}
```

---

## üîÑ 4. Estrat√©gia para Simular Depend√™ncias Externas

### 4.1 Arquitetura de Mocking

```mermaid
graph TD
    A[Aplica√ß√£o Local] --> B{Environment}
    B -->|development| C[MSW Interceptor]
    B -->|staging/prod| D[APIs Reais]
    
    C --> E[Banco Inter Mock]
    C --> F[ClickSign Mock]
    C --> G[Supabase Local]
    
    E --> H[Fixtures JSON]
    F --> I[Responses Mockadas]
    G --> J[PostgreSQL Container]
```

### 4.2 Implementa√ß√£o com MSW (Mock Service Worker)

```typescript
// mocks/handlers/banco-inter.ts
export const bancoInterHandlers = [
  rest.post('*/oauth/v2/token', (req, res, ctx) => {
    return res(ctx.json({
      access_token: 'mock-token-dev',
      token_type: 'Bearer',
      expires_in: 3600
    }))
  }),
  
  rest.post('*/banking/v2/boleto', (req, res, ctx) => {
    return res(ctx.json({
      nossoNumero: 'MOCK00000001',
      codigoBarras: '00000.00000 00000.000000 00000.000000 0 00000000000000',
      linhaDigitavel: '00000000000000000000000000000000000000000000000'
    }))
  })
]
```

### 4.3 Estrat√©gia de Dados de Teste

| Tipo de Dado | Estrat√©gia | Ferramenta |
|--------------|------------|------------|
| **Dados Transacionais** | Fixtures regener√°veis | Factory.ts + Faker.js |
| **Documentos** | PDFs template | pdf-lib |
| **Webhooks** | Servidor local | Express mock server |
| **Emails** | Captura local | MailHog container |
| **SMS** | Log console | Console interceptor |

### 4.4 Feature Flags para Desenvolvimento

```typescript
// config/features.development.ts
export const developmentFeatures = {
  'use-mock-apis': true,
  'skip-email-verification': true,
  'enable-debug-panel': true,
  'show-sql-queries': true,
  'bypass-rate-limits': true,
  'enable-hot-reload': true
}
```

---

## üìö 5. Documenta√ß√£o de Onboarding T√©cnico

### 5.1 Processo de Onboarding (< 30 minutos)

```markdown
## üöÄ Quick Start - Novo Desenvolvedor

### Pr√©-requisitos (10 min)
1. [ ] Instalar Docker Desktop
2. [ ] Instalar VS Code
3. [ ] Instalar extens√£o "Dev Containers" no VS Code

### Setup Inicial (15 min)
1. [ ] Clonar reposit√≥rio
   ```bash
   git clone https://github.com/simpix/simpix-app.git
   cd simpix-app
   ```

2. [ ] Abrir no VS Code
   ```bash
   code .
   ```

3. [ ] Quando aparecer prompt: "Reopen in Container" ‚Üí Click
   (Ou Cmd+Shift+P ‚Üí "Dev Containers: Reopen in Container")

4. [ ] Aguardar build do container (primeira vez ~10 min)

5. [ ] Container pronto! Terminal j√° configurado com:
   - Node 20.11.0
   - PostgreSQL 15 rodando
   - Redis rodando
   - Todas as depend√™ncias instaladas

### Verifica√ß√£o (5 min)
1. [ ] Rodar testes
   ```bash
   pnpm test
   ```

2. [ ] Iniciar aplica√ß√£o
   ```bash
   pnpm dev
   ```

3. [ ] Acessar http://localhost:5000

‚úÖ **Pronto para desenvolver!**
```

### 5.2 Comandos Dispon√≠veis no Container

```makefile
# Makefile inclu√≠do no container
help:           ## Mostra todos os comandos dispon√≠veis
setup:          ## Setup inicial do ambiente
dev:            ## Inicia servidor de desenvolvimento
test:           ## Roda todos os testes
test:watch:     ## Roda testes em modo watch
db:migrate:     ## Roda migrations do banco
db:seed:        ## Popula banco com dados de teste
mock:start:     ## Inicia servidores mock
lint:           ## Roda linting
format:         ## Formata c√≥digo
clean:          ## Limpa arquivos tempor√°rios
```

### 5.3 Troubleshooting Automatizado

```typescript
// scripts/doctor.ts
export async function runHealthCheck() {
  const checks = [
    { name: 'Node Version', check: () => process.version === 'v20.11.0' },
    { name: 'PostgreSQL', check: () => canConnectToDb() },
    { name: 'Redis', check: () => canConnectToRedis() },
    { name: 'Env Variables', check: () => validateEnvVars() },
    { name: 'Disk Space', check: () => hasSufficientSpace() }
  ]
  
  for (const check of checks) {
    const result = await check.check()
    console.log(`${result ? '‚úÖ' : '‚ùå'} ${check.name}`)
  }
}
```

---

## üìä 6. M√©tricas de Efic√°cia do Desenvolvedor (DevEx/SPACE)

### 6.1 Framework SPACE Adaptado

| Dimens√£o | M√©trica | Meta | Medi√ß√£o |
|----------|---------|------|---------|
| **Satisfaction** | Developer NPS | > 8.0 | Quarterly survey |
| **Performance** | PRs merged/week | > 5 | GitHub Analytics |
| **Activity** | Commits/day | > 3 | Git hooks |
| **Communication** | Code review time | < 4h | GitHub API |
| **Efficiency** | Build time | < 2min | CI/CD metrics |

### 6.2 M√©tricas Espec√≠ficas de DX

```typescript
// metrics/dx-metrics.ts
export interface DXMetrics {
  // Onboarding
  timeToFirstCommit: number        // Meta: < 1 dia
  timeToFirstPR: number            // Meta: < 3 dias
  onboardingCompletionRate: number // Meta: 100%
  
  // Produtividade
  localBuildTime: number           // Meta: < 30s
  testExecutionTime: number        // Meta: < 2min
  hotReloadTime: number            // Meta: < 2s
  
  // Qualidade
  environmentDriftIncidents: number // Meta: 0
  worksOnMyMachineIssues: number   // Meta: 0
  dependencyConflicts: number       // Meta: 0
  
  // Satisfa√ß√£o
  developerHappinessScore: number   // Meta: > 4.5/5
  toolingSatisfaction: number       // Meta: > 4.0/5
  documentationQuality: number      // Meta: > 4.0/5
}
```

### 6.3 Dashboard de Monitoramento

```yaml
# .github/workflows/dx-metrics.yml
name: DX Metrics Collection

on:
  schedule:
    - cron: '0 0 * * 1' # Weekly
  workflow_dispatch:

jobs:
  collect-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Collect onboarding metrics
        run: |
          echo "Time to first commit: $(calculate_ttfc)"
          echo "Environment setup success rate: $(calculate_setup_rate)"
          
      - name: Collect productivity metrics
        run: |
          echo "Average local build time: $(measure_build_time)"
          echo "Test execution time: $(measure_test_time)"
          
      - name: Send to monitoring
        run: |
          curl -X POST $METRICS_ENDPOINT \
            -H "Content-Type: application/json" \
            -d @metrics.json
```

### 6.4 OKRs de Developer Experience

```markdown
## Q4 2025 - OKRs de DX

### Objective: Alcan√ßar excel√™ncia em Developer Experience

**KR1:** Reduzir tempo de onboarding de 3 dias para 30 minutos
- Baseline: 3 dias
- Target: 30 minutos
- Medi√ß√£o: Tempo do git clone ao primeiro commit

**KR2:** Eliminar 100% dos "funciona na minha m√°quina"
- Baseline: 5 incidentes/m√™s
- Target: 0 incidentes
- Medi√ß√£o: Tickets taggeados como environment-issue

**KR3:** Alcan√ßar NPS > 8.0 na satisfa√ß√£o dos desenvolvedores
- Baseline: 6.5
- Target: 8.0+
- Medi√ß√£o: Survey trimestral

**KR4:** Reduzir tempo de CI/CD em 50%
- Baseline: 12 minutos
- Target: 6 minutos
- Medi√ß√£o: GitHub Actions metrics
```

---

## üöÄ 7. Roadmap de Implementa√ß√£o

### Fase 1: Funda√ß√£o (Semana 1-2)
- [ ] Criar `devcontainer.json` base
- [ ] Configurar Docker Compose para servi√ßos
- [ ] Implementar MSW handlers b√°sicos
- [ ] Documentar processo de setup

### Fase 2: Automa√ß√£o (Semana 3-4)
- [ ] Scripts de automa√ß√£o (Makefile)
- [ ] Health checks automatizados
- [ ] Feature flags para desenvolvimento
- [ ] CI/CD integration tests

### Fase 3: Ado√ß√£o (Semana 5-6)
- [ ] Treinamento da equipe
- [ ] Migra√ß√£o progressiva
- [ ] Coleta de feedback
- [ ] Ajustes baseados em uso real

### Fase 4: Otimiza√ß√£o (Cont√≠nuo)
- [ ] Monitoramento de m√©tricas DX
- [ ] Melhorias incrementais
- [ ] Atualiza√ß√£o de depend√™ncias
- [ ] Expans√£o de mocks

---

## üìù 8. Anexos

### 8.1 Exemplo de devcontainer.json

```json
{
  "name": "Simpix Development",
  "dockerComposeFile": "docker-compose.yml",
  "service": "app",
  "workspaceFolder": "/workspace",
  
  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/node:1": {
      "version": "20.11.0",
      "nodeGypDependencies": true
    }
  },
  
  "customizations": {
    "vscode": {
      "extensions": [
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode"
      ],
      "settings": {
        "editor.formatOnSave": true,
        "editor.codeActionsOnSave": {
          "source.fixAll.eslint": true
        }
      }
    }
  },
  
  "postCreateCommand": "pnpm install && pnpm db:migrate",
  "remoteUser": "node"
}
```

### 8.2 Estrutura de Mocks Proposta

```
mocks/
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ banco-inter.ts
‚îÇ   ‚îú‚îÄ‚îÄ clicksign.ts
‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ fixtures/
‚îÇ   ‚îú‚îÄ‚îÄ proposals.json
‚îÇ   ‚îú‚îÄ‚îÄ users.json
‚îÇ   ‚îî‚îÄ‚îÄ documents.json
‚îú‚îÄ‚îÄ factories/
‚îÇ   ‚îú‚îÄ‚îÄ proposal.factory.ts
‚îÇ   ‚îú‚îÄ‚îÄ user.factory.ts
‚îÇ   ‚îî‚îÄ‚îÄ document.factory.ts
‚îî‚îÄ‚îÄ server.ts
```

---

## ‚úÖ 9. Crit√©rios de Sucesso

| Crit√©rio | Meta | Prazo |
|----------|------|-------|
| Tempo de setup novo dev | < 30 min | 30 dias |
| Taxa de ado√ß√£o | 100% | 60 dias |
| Redu√ß√£o de bugs de ambiente | 100% | 90 dias |
| Satisfa√ß√£o da equipe | > 8/10 | 90 dias |
| ROI em produtividade | > 20% | 120 dias |

---

**Assinatura:** GEM-02 Dev Specialist  
**Data:** 22/08/2025  
**Status:** Aguardando aprova√ß√£o do Arquiteto Chefe  
**Pr√≥xima Revis√£o:** 30 dias ap√≥s implementa√ß√£o