
> rest-express@1.0.0 dev
‚úÖ Database: Configuring Supabase connection...
‚úÖ Database: Connection configured (lazy)
[CLICKSIGN V1] üöÄ Initialized in PRODUCTION mode (legal signatures)
[CLICKSIGN V1] API URL: https://app.clicksign.com/api/v1
[CLICKSIGN V1] Token configured: b73b3b90-c87...
[CLICKSIGN] üî¥ Circuit Breaker will be initialized on first use
[INTER] üè¶ Initialized in production mode
[INTER] üåê API URL: https://cdpj.partners.bancointer.com.br
[INTER] üî¥ Circuit Breakers will be initialized on first use
[CLICKSIGN V1] üöÄ Initialized in PRODUCTION mode (legal signatures)
[CLICKSIGN V1] API URL: https://app.clicksign.com/api/v1
[CLICKSIGN V1] Token configured: b73b3b90-c...
[DEV QUEUE] üì¶ Created development queue: pdf-processing
[DEV QUEUE] üì¶ Created development queue: boleto-sync
[DEV QUEUE] üì¶ Created development queue: document-processing
[DEV QUEUE] üì¶ Created development queue: notifications
[DEV QUEUE] üöÄ Development queues initialized with REAL worker processing
üöÄ [TIMING MIDDLEWARE] Creating middleware instance...
üöÄ [TIMING MIDDLEWARE] Middleware instance created and exported
2:25:23 PM [express] ‚úÖ All secrets loaded successfully
2:25:23 PM [express] üîí [SECURITY] CORS protection configured - ASVS V13.2.1
2:25:23 PM [express] üîí [SECURITY] OPTIONS preflight handling configured
2:25:23 PM [express] üîß [DEV] Using basic CSP configuration optimized for Vite development
2:25:23 PM [express] üîí [SECURITY] Input sanitization middleware activated
2:25:23 PM [express] üîí [SECURITY] URL token validation middleware activated - ASVS V7.1.1
2:25:23 PM [express] üîí [SECURITY] CSRF protection middleware activated - OWASP Cheat Sheet
2:25:23 PM [express] üîß [DEV] Rate limiting configurado para desenvolvimento - limites altos
[SEMGREP MCP] Development mode - using in-memory cache
üß† [ML] Treinando modelo de detec√ß√£o...
2:25:23 PM [express] üîê Security WebSocket initialized
[CCB SYNC] üöÄ Starting fallback polling (every 6 hours)
[CCB SYNC] ‚ÑπÔ∏è Primary processing via webhooks, polling is safety net only
2:25:23 PM [express] üîÑ CCB Sync Service initialized - Webhook primary, polling fallback every 6 hours
2:25:23 PM [express] üîî Sistema de Alertas Proativos inicializado - Pr√≥xima execu√ß√£o: 19/08/2025, 04:00:00
2:25:23 PM [express] ‚ÑπÔ∏è  Security monitoring disabled. Set ENABLE_SECURITY_MONITORING=true to enable
2:25:23 PM [express] üîß App Config Status:
2:25:23 PM [express]   - Port: 5000
2:25:23 PM [express]   - Environment: development
2:25:23 PM [express]   - Database: ‚úÖ Connected
2:25:23 PM [express]   - Supabase: ‚úÖ Connected
2:25:23 PM [express]   - Security: Rate Limit ‚úÖ, Helmet ‚úÖ
2:25:23 PM [express] üöÄ Server running on port 5000
2:25:23 PM [express] üåç Environment: development
2:25:23 PM [express] üì¶ Checking storage buckets...
2:25:24 PM [express] ‚úÖ Storage bucket "documents" already exists as PRIVATE
Browserslist: browsers data (caniuse-lite) is 10 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
‚úÖ [ML] Modelo treinado com 0 amostras
‚úÖ Database: Connection test successful
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /api/debug/me
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/cobrancas
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T14:26:04.045Z'
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /api/debug/me
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/cobrancas
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîç [COBRAN√áAS] ====== IN√çCIO DA BUSCA DE PROPOSTAS ======
üîç [COBRAN√áAS] Filtros aplicados: { status: undefined, atraso: undefined }
üîç [COBRAN√áAS] PAM V1.0 - Filtrando propostas por STATUS conforme Blueprint...
[DEBUG-BACKEND-1] Iniciando query de cobran√ßas com os seguintes filtros: {
  statusElegiveis: [
    'BOLETOS_EMITIDOS',
    'PAGAMENTO_PENDENTE',
    'PAGAMENTO_PARCIAL',
    'PAGAMENTO_CONFIRMADO',
    'pronto_pagamento'
  ],
  whereConditions: '[object Object]',
  userRole: '',
  queryParams: { status: undefined, atraso: undefined }
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /notificacoes
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/cobrancas
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T14:26:15.310Z'
}
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T14:26:15.568Z'
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /api/debug/me
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/cobrancas
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T14:26:16.091Z'
}
[DEBUG-BACKEND-2] Resultado BRUTO do DB: {
  totalPropostas: 3,
  primeiraProposta: {
    id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
    numeroProposta: 300028,
    lojaId: 13,
    status: 'BOLETOS_EMITIDOS',
    clienteNome: 'Gabriel de Jesus Santana Serri',
    clienteCpf: '20528464760',
    clienteEmail: 'gabrieldjesus238@gmail.com',
    clienteTelefone: '(27) 99853-8565',
    clienteDataNascimento: '1990-05-15',
    clienteRenda: '5000.00',
    clienteRg: null,
    clienteOrgaoEmissor: null,
    clienteRgUf: null,
    clienteRgDataEmissao: null,
    clienteEstadoCivil: null,
    clienteNacionalidade: 'Brasileira',
    clienteLocalNascimento: null,
    clienteCep: '29165-460',
    clienteEndereco: 'Rua miguel angelo',
    clienteLogradouro: null,
    clienteNumero: null,
    clienteComplemento: null,
    clienteBairro: null,
    clienteCidade: null,
    clienteUf: null,
    clienteOcupacao: null,
    tipoPessoa: 'PF',
    clienteRazaoSocial: null,
    clienteCnpj: null,
    valor: '1000.00',
    prazo: 12,
    valorTac: '50.00',
    valorIof: '150.00',
    valorTotalFinanciado: '1000.00',
    valorLiquidoLiberado: null,
    taxaJuros: '2.50',
    dataAprovacao: 2025-08-01T13:21:55.000Z,
    ccbGerado: true,
    assinaturaEletronicaConcluida: true,
    dadosPagamentoBanco: null,
    dadosPagamentoAgencia: null,
    dadosPagamentoConta: null,
    dadosPagamentoTipo: null,
    dadosPagamentoPix: null,
    dadosPagamentoTipoPix: null,
    createdAt: 2025-08-01T16:08:35.623Z,
    deletedAt: null
  },
  idsEncontrados: [
    '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
    '88a44696-9b63-42ee-aa81-15f9519d24cb',
    'formal-test-005'
  ],
  statusEncontrados: [
    {
      id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
      status: 'BOLETOS_EMITIDOS'
    },
    {
      id: '88a44696-9b63-42ee-aa81-15f9519d24cb',
      status: 'BOLETOS_EMITIDOS'
    },
    { id: 'formal-test-005', status: 'BOLETOS_EMITIDOS' }
  ]
}
üîç [COBRAN√áAS] PAM V1.0 - Encontradas 3 propostas com status eleg√≠vel
[ALERTAS] Mapeamento: gabrielserri238@gmail.com -> Local ID: 2
[ALERTAS] Encontradas 4 notifica√ß√µes, 0 n√£o lidas
üîç [COBRAN√áAS] Total de propostas ap√≥s filtros: 3
üîç [COBRAN√áAS] ====== FIM DA BUSCA DE PROPOSTAS ======
[DEBUG-BACKEND-3] Payload FINAL enviado para o Frontend: {
  totalPropostas: 3,
  primeiraPropostaCompleta: {
    id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
    numeroContrato: '902183DD',
    nomeCliente: 'Gabriel de Jesus Santana Serri',
    cpfCliente: '20528464760',
    telefoneCliente: '(27) 99853-8565',
    emailCliente: 'gabrieldjesus238@gmail.com',
    enderecoCliente: 'Rua miguel angelo',
    cepCliente: '29165-460',
    valorTotal: 1000,
    valorFinanciado: 1000,
    quantidadeParcelas: 6,
    parcelasPagas: 0,
    parcelasPendentes: 6,
    parcelasVencidas: 0,
    valorTotalPago: 0,
    valorTotalPendente: 1203.8,
    valorTotalVencido: 0,
    diasAtraso: 0,
    status: 'em_dia',
    dataContrato: 2025-08-01T13:21:55.000Z,
    ccbAssinada: true,
    parcelas: [ [Object], [Object], [Object], [Object], [Object], [Object] ],
    interCodigoSolicitacao: '44a467d1-e93f-4e91-b1f9-c79438ef5eea',
    interSituacao: 'A_RECEBER',
    interDataVencimento: '2025-11-10',
    dadosBancarios: {
      banco: null,
      agencia: null,
      conta: null,
      tipoConta: null,
      pix: null,
      tipoPix: null
    }
  },
  resumoDados: [
    {
      id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
      nomeCliente: 'Gabriel de Jesus Santana Serri',
      cpfCliente: '20528464760',
      status: 'em_dia',
      valorTotal: 1000
    },
    {
      id: '88a44696-9b63-42ee-aa81-15f9519d24cb',
      nomeCliente: 'Gabriel Santana Jesus ',
      cpfCliente: '205.284.647-60',
      status: 'em_dia',
      valorTotal: 0
    },
    {
      id: 'formal-test-005',
      nomeCliente: 'Carlos Ferreira Pagamento',
      cpfCliente: '99988877766',
      status: 'em_dia',
      valorTotal: 0
    }
  ]
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /api/debug/me
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/cobrancas
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T14:27:13.039Z'
}
[SYNC STATUS PAM V1.0] Verificando estado de sincroniza√ß√£o para proposta 88a44696-9b63-42ee-aa81-15f9519d24cb
[SYNC STATUS PAM V1.0] Proposta 88a44696-9b63-42ee-aa81-15f9519d24cb: {
  syncStatus: 'nao_iniciado',
  totalBoletos: 48,
  boletosSincronizados: 0
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /notificacoes
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/cobrancas
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T14:27:18.272Z'
}
[ALERTAS] Mapeamento: gabrielserri238@gmail.com -> Local ID: 2
[ALERTAS] Encontradas 4 notifica√ß√µes, 0 n√£o lidas
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /88a44696-9b63-42ee-aa81-15f9519d24cb/gerar-carne
[JWT DEBUG] M√©todo: POST
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/cobrancas
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T14:27:20.347Z'
}
[CARNE API - PRODUCER] üéØ Solicita√ß√£o de carn√™ para proposta: 88a44696-9b63-42ee-aa81-15f9519d24cb
[CARNE API - PRODUCER] üë§ Usu√°rio: a65efc54-90cd-4b94-b971-c8a560104032
[CARNE API - PRODUCER] ‚úÖ Proposta v√°lida - ID: 88a44696-9b63-42ee-aa81-15f9519d24cb, Nome: Gabriel Santana Jesus 
[CARNE API - PRODUCER] üîç Verificando se j√° existe carn√™ no Storage...
[PAM V1.0 DIAGN√ìSTICO] üîç /gerar-carne CAMINHO_EXATO: "propostas/88a44696-9b63-42ee-aa81-15f9519d24cb/carnes"
[PAM V1.0 DIAGN√ìSTICO] üîç /gerar-carne RESULTADO_COMPLETO:
[PAM V1.0 DIAGN√ìSTICO]   - Bucket: documents
[PAM V1.0 DIAGN√ìSTICO]   - Path: propostas/88a44696-9b63-42ee-aa81-15f9519d24cb/carnes
[PAM V1.0 DIAGN√ìSTICO]   - listError: null
[PAM V1.0 DIAGN√ìSTICO]   - existingFiles length: 1
[PAM V1.0 DIAGN√ìSTICO]   - existingFiles data: [
  {
    "name": "carne-2025-08-13_18-24-48-667.pdf",
    "id": "75c60b0a-fdc1-482d-9160-ccae7619fee6",
    "updated_at": "2025-08-13T18:24:50.005Z",
    "created_at": "2025-08-13T18:24:50.005Z",
    "last_accessed_at": "2025-08-13T18:24:50.005Z",
    "metadata": {
      "eTag": "\"73459a6daa04990ed8912f8d3c441624\"",
      "size": 965522,
      "mimetype": "application/pdf",
      "cacheControl": "max-age=3600",
      "lastModified": "2025-08-13T18:24:50.000Z",
      "contentLength": 965522,
      "httpStatusCode": 200
    }
  }
]
[CARNE API - PRODUCER] ‚úÖ Carn√™ j√° existe: carne-2025-08-13_18-24-48-667.pdf
[PAM V1.0 DIAGN√ìSTICO] üîç /gerar-carne ARQUIVO_ENCONTRADO:
[PAM V1.0 DIAGN√ìSTICO]   - fileName: carne-2025-08-13_18-24-48-667.pdf
[PAM V1.0 DIAGN√ìSTICO]   - filePath: propostas/88a44696-9b63-42ee-aa81-15f9519d24cb/carnes/carne-2025-08-13_18-24-48-667.pdf
[PAM V1.0 DIAGN√ìSTICO]   - arquivo completo: {
  "name": "carne-2025-08-13_18-24-48-667.pdf",
  "id": "75c60b0a-fdc1-482d-9160-ccae7619fee6",
  "updated_at": "2025-08-13T18:24:50.005Z",
  "created_at": "2025-08-13T18:24:50.005Z",
  "last_accessed_at": "2025-08-13T18:24:50.005Z",
  "metadata": {
    "eTag": "\"73459a6daa04990ed8912f8d3c441624\"",
    "size": 965522,
    "mimetype": "application/pdf",
    "cacheControl": "max-age=3600",
    "lastModified": "2025-08-13T18:24:50.000Z",
    "contentLength": 965522,
    "httpStatusCode": 200
  }
}
