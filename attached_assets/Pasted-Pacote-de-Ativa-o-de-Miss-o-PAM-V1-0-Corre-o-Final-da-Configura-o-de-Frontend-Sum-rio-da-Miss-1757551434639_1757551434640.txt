Pacote de Ativação de Missão (PAM) V1.0 - Correção Final da Configuração de Frontend
Sumário da Missão: Refatorar a lógica de inicialização do cliente Supabase para ler as variáveis de ambiente corretas, com o prefixo VITE_, que são expostas ao frontend pelo compilador Vite.

Intenção Estratégica: Alinhar o código da aplicação com a configuração de infraestrutura correta e a política de segurança do Vite, resolvendo permanentemente o erro "Configuração do Supabase em falta" e restaurando a funcionalidade completa da aplicação em produção.

Histórico Relevante: Está agora provado que a falha reside na tentativa de ler secrets do process.env a partir do código do cliente. A solução é ler as secrets com prefixo VITE_ a partir de import.meta.env, conforme a arquitetura do Vite.

IMPLEMENTAR:
Alterar a lógica de inicialização do Supabase em client/src/lib/supabase.ts para ler as variáveis de ambiente VITE_PROD_SUPABASE_URL e VITE_PROD_SUPABASE_ANON_KEY quando em produção.

CURRENT STATE:

Ficheiro: client/src/lib/supabase.ts

Lógica com Falha:

TypeScript

const supabaseUrl = import.meta.env.PROD
  ? process.env.PROD_SUPABASE_URL 
  : import.meta.env.VITE_SUPABASE_URL;
Evidência Bruta: Este código falha porque process.env não está disponível no frontend, resultando em undefined.

EXPECTED (Estado Final de Sucesso):

Ficheiro: client/src/lib/supabase.ts

Código Corrigido (Definitivo): A lógica deve ser alterada para ler as variáveis de import.meta.env que você criou.

TypeScript

import { createClient } from '@supabase/supabase-js';

// Lógica sensível ao ambiente para carregar as credenciais corretas.
const supabaseUrl = import.meta.env.PROD
  ? import.meta.env.VITE_PROD_SUPABASE_URL
  : import.meta.env.VITE_SUPABASE_URL;

const supabaseAnonKey = import.meta.env.PROD
  ? import.meta.env.VITE_PROD_SUPABASE_ANON_KEY
  : import.meta.env.VITE_SUPABASE_ANON_KEY;

// Validação explícita que agora irá funcionar.
if (!supabaseUrl || !supabaseAnonKey) {
    console.error('--- ERRO CRÍTICO DE CONFIGURAÇÃO FRONTEND ---');
    console.error('Variáveis de ambiente Supabase (URL ou Anon Key) não estão configuradas para o ambiente atual.');
    throw new Error('Configuração do Supabase em falta. A aplicação não pode iniciar.');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);