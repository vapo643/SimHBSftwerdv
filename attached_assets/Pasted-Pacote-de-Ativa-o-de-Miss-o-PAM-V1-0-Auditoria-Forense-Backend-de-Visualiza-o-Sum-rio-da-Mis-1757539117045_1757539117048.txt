Pacote de Ativação de Missão (PAM) V1.0 - Auditoria Forense (Backend de Visualização)
Sumário da Missão: Realizar uma auditoria forense para identificar e analisar a cadeia de lógica do backend responsável por listar os documentos de uma proposta e gerar as suas URLs de visualização seguras.

Cenário de Negócio (O "Caso de Teste"): Um ANALISTA acede à página de detalhes de uma proposta com o ID prop-123. Esta proposta tem dois ficheiros armazenados em docs-prop/prop-123/: contrato.pdf e identidade.jpg. O backend deve: 1) Listar ambos os ficheiros. 2) Para cada ficheiro, gerar uma URL de visualização segura e assinada do Supabase, com validade de 7 dias (604800 segundos).

Vetor de Ataque / Ponto de Falha (O "Risco"): A hipótese principal é que a lógica de backend foi quebrada durante uma refatoração anterior. A falha pode estar em um dos seguintes pontos:

A função não está a conseguir listar corretamente os ficheiros do diretório de storage do Supabase.

A função está a listar os ficheiros, mas está a falhar ao tentar gerar as URLs assinadas (getSignedUrl).

O endpoint da API ou o loader do Remix não está a retornar a lista de ficheiros e URLs para o frontend.

Evidência de Conformidade Requerida (A "Prova Irrefutável"):

NÃO MODIFIQUE NENHUM CÓDIGO. A sua única missão é LER, ANALISAR e APRESENTAR os trechos de código solicitados.

1. Mapeamento do Ponto de Entrada da API/Loader:
a. Identifique e liste o(s) ficheiro(s) de backend (loader do Remix ou rota de API) que é(são) acionado(s) quando o frontend solicita os detalhes de uma proposta para análise.
b. Apresente o trecho de código completo desta função que recebe o ID da proposta como parâmetro.

2. Mapeamento da Lógica de Serviço (Busca de Ficheiros):
a. A partir do ponto de entrada acima, rastreie e identifique o ficheiro de serviço (provavelmente em app/services/ ou similar) que contém a lógica para interagir com o Supabase Storage.
b. Apresente o trecho de código exato dentro deste serviço que executa a função supabase.storage.from('...').list(...) para obter a lista de ficheiros de um determinado diretório de proposta (ex: docs-prop/<ID_DA_PROPOSTA>).

3. Mapeamento da Lógica de Geração de URL:
a. Dentro do mesmo ficheiro de serviço, localize e apresente o trecho de código (provavelmente dentro de um loop) que itera sobre a lista de ficheiros retornada.
b. Mostre a chamada exata à função supabase.storage.from('...').createSignedUrl(...) ou getSignedUrl. Confirme se o tempo de expiração (expiresIn) está a ser definido para 604800 segundos (7 dias).
c. Apresente a estrutura do objeto ou array que é retornado por esta função (deve conter, no mínimo, o nome do ficheiro e a sua URL assinada).