eredito recebido. ALERTA VERMELHO. Regress√£o cr√≠tica em m√∫ltiplas funcionalidades centrais ap√≥s o deploy. A estabilidade do sistema est√° comprometida. A sua frustra√ß√£o √© compreens√≠vel e a situa√ß√£o √© inaceit√°vel.

Ativando Protocolo de Gerenciamento de Interrup√ß√£o (PGI) V1.1 com a m√°xima prioridade. O meu modo de opera√ß√£o de Realismo C√©tico √© agora absoluto. A premissa √© que as implementa√ß√µes anteriores falharam ou foram revertidas.

Causa da Interrup√ß√£o: M√∫ltiplas Regress√µes Cr√≠ticas em Produ√ß√£o.
Novo Foco (Miss√£o de Emerg√™ncia): Lan√ßar uma super auditoria forense, a "Opera√ß√£o Soberania dos Dados", para dissecar e erradicar as falhas na pipeline de documentos e no fluxo de aprova√ß√£o.

STATUS: STANDBY (INICIANDO PROTOCOLO DE DESIGN DE MISS√ÉO DE ELITE)

A sua diretriz para uma investiga√ß√£o profunda est√° correta e ser√° executada com rigor m√°ximo. A evid√™ncia que voc√™ forneceu ‚Äî especialmente o TypeError: Cannot read properties of undefined (reading 'getProposalDocuments') ‚Äî √© a nossa "pista forense" mais importante e aponta para uma falha catastr√≥fica na l√≥gica de neg√≥cio.

An√°lise Forense de Causa Raiz (RCA)
A cascata de falhas reportada indica uma fratura profunda, provavelmente interligada.

Falha na Aprova√ß√£o (Erro Cr√≠tico P0 - TypeError):

Sintoma: O analista n√£o consegue aprovar a proposta, resultando num erro 500.

Evid√™ncia Prim√°ria: O log TypeError: Cannot read properties of undefined (reading 'getProposalDocuments') dentro do ApproveProposalUseCase.validateFormalizationRequirements √© inequ√≠voco. A causa raiz √© que o use case de aprova√ß√£o est√° a tentar chamar um m√©todo (getProposalDocuments) numa vari√°vel que est√° undefined. Isto sugere fortemente que o objeto proposal, quando recuperado de dentro deste use case, n√£o √© uma inst√¢ncia v√°lida do agregado de dom√≠nio Proposal ou est√° a chegar como null.

Falha no Armazenamento de Documentos (Bug de Integridade de Dados P1):

Sintoma: Os documentos est√£o a ser guardados numa estrutura de pastas incorreta no Supabase Storage.

Hip√≥tese: A l√≥gica de upload no backend (provavelmente no documentsService.ts ou no SupabaseStorageAdapter.ts) n√£o est√° a construir o path de destino conforme a especifica√ß√£o (docs-prop/<proposal_id>/<filename>).

Falha na Visualiza√ß√£o de Documentos (Regress√£o Funcional P1):

Sintoma: O componente para ver/baixar documentos n√£o aparece no painel de an√°lise.

Hip√≥tese: Esta falha √© provavelmente um sintoma direto da falha de armazenamento (Ponto 2). Se os documentos est√£o a ser guardados no local errado, a l√≥gica de leitura (que espera a estrutura de pastas correta) n√£o os encontrar√°, resultando num array vazio e na n√£o renderiza√ß√£o do componente.

Roadmap da Super Auditoria: Opera√ß√£o "Soberania dos Dados"
Esta opera√ß√£o ir√° dissecar e corrigir toda a pipeline de documentos, da escrita √† leitura.

Thread de Investiga√ß√£o A: Erradica√ß√£o da Falha de Aprova√ß√£o (Prioridade P0)

[üéØ EM EXECU√á√ÉO] Passo A.1 (Auditoria do ApproveProposalUseCase): Gerar um PAM para o 'Sniper' realizar uma an√°lise forense do arquivo server/modules/proposal/application/ApproveProposalUseCase.ts. O objetivo √© rastrear a origem do objeto proposal e provar por que ele est√° undefined ou incompleto no momento em que validateFormalizationRequirements √© chamado.

Thread de Investiga√ß√£o B: Corre√ß√£o da Pipeline de Escrita de Documentos (Prioridade P1)

[PENDENTE] Passo B.1 (Auditoria do Servi√ßo de Storage): Gerar um PAM para o 'Sniper' auditar o documentsService.ts e o SupabaseStorageAdapter.ts para encontrar a l√≥gica que constr√≥i o path de armazenamento e identificar por que n√£o est√° a seguir o formato docs-prop/<proposal_id>/<filename>.

[PENDENTE] Passo B.2 (Implementa√ß√£o da Estrutura de Pastas): Com base na auditoria, gerar um PAM para a 'Bazuca' para corrigir a l√≥gica de constru√ß√£o do path de armazenamento.

Thread de Investiga√ß√£o C: Restaura√ß√£o da Pipeline de Leitura de Documentos (Prioridade P1)

[PENDENTE] Passo C.1 (Auditoria e Corre√ß√£o do Frontend): Ap√≥s a corre√ß√£o da escrita, validar a l√≥gica de renderiza√ß√£o em client/src/pages/credito/analise.tsx e componentes filhos para garantir que os links dos documentos sejam exibidos corretamente.

Thread de Investiga√ß√£o D: Refinamento Visual (Prioridade P2)

[PENDENTE] Passo D.1 (Remo√ß√£o do Texto da TAC): Gerar um PAM para a 'Bazuca' para remover o texto da TAC de LoanConditionsStep.tsx.

Pr√≥xima A√ß√£o:
Executor Humano, a seguir est√° o Pacote de Ativa√ß√£o de Miss√£o (PAM) para o Passo A.1. A estabiliza√ß√£o do fluxo de aprova√ß√£o √© a nossa prioridade absoluta. Entregue este comando ao 'Sniper'.