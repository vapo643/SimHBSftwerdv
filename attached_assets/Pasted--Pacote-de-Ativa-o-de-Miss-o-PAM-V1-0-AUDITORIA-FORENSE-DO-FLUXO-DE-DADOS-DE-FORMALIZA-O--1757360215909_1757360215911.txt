### **Pacote de Ativação de Missão (PAM) V1.0 - AUDITORIA FORENSE DO FLUXO DE DADOS DE FORMALIZAÇÃO**

* **Sumário da Missão:** Realizar uma auditoria forense de ponta-a-ponta no fluxo de dados que alimenta a tela de Formalização de Propostas para identificar a causa raiz da ausência de dados críticos, incluindo documentos e parâmetros para geração de CCB.

* **Cenário de Negócio (O "Caso de Teste"):** Um `ANALISTA` aprova uma proposta e avança para a tela de Formalização (`/formalizacao/:id`). A tela carrega, mas não exibe a lista de documentos associados à proposta nem os parâmetros financeiros detalhados necessários para a geração da CCB.

* **Vetor de Ataque / Ponto de Falha (Hipóteses):**
    1.  **Componente Frontend (`formalizacao.tsx`):** O componente não está a solicitar todos os dados necessários ou está a falhar ao tentar renderizar as secções de documentos e parâmetros.
    2.  **Endpoint da API (Backend):** O endpoint que serve os dados para esta tela está a devolver um objeto de proposta incompleto, sem agregar os documentos relacionados ou os parâmetros detalhados da CCB.
    3.  **Camada de Repositório (Backend):** A query no `ProposalRepository` ou em um repositório relacionado (ex: `DocumentRepository`) é inadequada, falhando em realizar os `JOINs` ou as sub-queries necessárias para coletar todas as informações.
    4.  **Modelo de Domínio (Backend):** A entidade de domínio `Proposal` pode não ter os relacionamentos ou propriedades para carregar os documentos e parâmetros, quebrando o fluxo de dados na camada de negócio.

* **Evidência de Conformidade Requerida (A "Prova Irrefutável"):**

1.  **Análise do Frontend:**
    * Localize o ficheiro da página de Formalização (provavelmente `client/src/pages/formalizacao.tsx`).
    * Apresente o código do componente. Mostre o hook do TanStack Query (`useQuery`) que ele utiliza para buscar os dados da proposta para formalização.

2.  **Análise da Chamada de Rede:**
    * Dentro do hook `useQuery` identificado, aponte a função de busca (`apiClient.get(...)`). Qual é o endpoint exato da API que está a ser chamado para obter os dados de formalização?

3.  **Análise do Backend (Controller e Rota):**
    * Navegue até o ficheiro de rotas relevante e localize a definição da rota para o endpoint identificado acima.
    * Apresente o código da rota e identifique qual método do `proposalController` (ou outro controller) é acionado.
    * Apresente o código completo do método correspondente no ficheiro do controller.

4.  **Análise da Camada de Dados (Repositório):**
    * Siga o fluxo a partir do controller até ao `UseCase` e, finalmente, ao método no `ProposalRepository` que executa a query no banco de dados para obter os dados de formalização.
    * Apresente a query Drizzle ORM completa que busca os dados. Verifique se existem `JOINs` com as tabelas de `documentos` e se os campos necessários para a CCB estão a ser selecionados.

5.  **Veredito Final:** Com base na análise completa, explique precisamente por que os dados de formalização (documentos e parâmetros da CCB) não estão a ser exibidos. A falha está no frontend que não pede, na API que não envia, ou no banco de dados que não fornece?