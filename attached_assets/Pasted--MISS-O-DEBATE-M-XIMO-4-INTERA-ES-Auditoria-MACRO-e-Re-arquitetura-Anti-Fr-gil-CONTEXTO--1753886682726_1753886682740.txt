# MISSÃO: DEBATE MÁXIMO (4 INTERAÇÕES) - Auditoria MACRO e Re-arquitetura Anti-Frágil

**CONTEXTO ESTRATÉGICO E HISTÓRICO:**
Olá, Assistente. Estamos num ponto de viragem. Tivemos um avanço monumental quando o nosso Comandante Estratégico nos guiou a estudar e a implementar o Row Level Security (RLS) no Supabase. Pela primeira vez, conseguimos fazer com que a segurança a nível de banco de dados funcionasse, restringindo a visão do `ATENDENTE` de forma correta. Foi um grande êxito.

No entanto, a implementação que se seguiu para refinar a "Fila de Formalização" resultou numa falha em cascata que quebrou completamente o painel de administração, mesmo para o `ADMINISTRADOR`. A nossa base de código está frágil, e as correções pontuais estão a causar mais problemas do que a resolver.

A nossa missão agora não é corrigir um bug. É re-arquitetar a nossa fundação para que ela seja infalível.

**SUA TAREFA (ASSISTENTE):**
A sua tarefa é atuar como um Arquiteto de Software Sênior e realizar um "Raio-X" completo da nossa base de código para identificar a causa raiz desta fragilidade. Esta será a nossa **Interação 1 de 4**.

---
### **Interação 1: Diagnóstico Holístico da Causa Raiz**

Por favor, analise a nossa situação crítica, com base nos sintomas que o nosso Comandante validou em campo. Não proponha código ainda. Proponha a **estratégia**.

**Os Sintomas Atuais (O Que o Administrador Vê):**

1.  **Na "Gestão de Usuários":** A página carrega, mas onde deveria estar a tabela, aparece a mensagem **"erro ao carregar usuarios"** e um botão de "Tente Novamente".
2.  **Na "Gestão de Lojas":** A lista de lojas sumiu. Ao tentar criar uma "Nova Loja", é impossível, porque o campo para selecionar o **"Parceiro" não puxa nenhum dado**.
3.  **Na "Gestão de Parceiros":** Ao tentar criar um novo parceiro, a API retorna um erro a dizer que o `ADMINISTRADOR` precisa de **"permissões de admin requeridas"**.

**A Minha Pergunta Para Você (Análise MACRO):**

Qual é a sua **"Teoria do Ponto Único de Falha"**? Você acredita que estes três problemas são bugs isolados, ou são todos sintomas de uma única e mesma falha arquitetural fundamental que foi exposta após a nossa última implementação? Se sim, qual é a sua teoria sobre esta falha?

**O Eixo da Falha (Backend vs. Frontend):**
Onde você localiza o epicentro desta fragilidade? É uma falha na nossa camada de **backend** (ex: o middleware `jwt-auth-middleware.ts` não está a enriquecer a sessão do admin corretamente), na nossa camada de **frontend** (ex: a gestão de estado ou o `apiClient` estão quebrados), ou uma falha de comunicação entre as duas?