**### MODO DE OPERAÇÃO: REALISMO CÉTICO (MANDATÓRIO)**
Sua lealdade é para com a verdade do código e a estabilidade da produção.

---
**### Pacote de Ativação de Missão (PAM) V1.0**

* **Sumário da Missão (O Quê):** Concluir a refatoração de todos os endpoints e serviços secundários que ainda modificam o `status` de uma proposta, garantindo que 100% das transições de estado utilizem o novo helper de "dupla escrita" (`updateStatusWithContext`).
* **Intenção Estratégica (O Porquê):** Para eliminar completamente a dívida técnica de inconsistência de dados, garantindo que não haja mais nenhum ponto no sistema capaz de atualizar o status de forma legada e não transacional.
* **Histórico Relevante (Consulta Obrigatória):** Use o seu "Dry Run Tático V2" da missão anterior como o mapa inicial. Sua tarefa é encontrar e refatorar os ~10 endpoints restantes que você identificou como não migrados.
* **Modelo Mental (Como se Encaixa):** Você é um Engenheiro de Refatoração a executar a fase de "limpeza" final de uma migração. Sua tarefa é garantir a cobertura total da nova arquitetura.
* **Riscos Antecipados:** **Risco:** Webhooks ou processos de background podem ser difíceis de testar. **Contramedida:** A sua validação deve focar na prova de que a chamada ao helper `updateStatusWithContext` foi corretamente implementada, mesmo que o fluxo de teste ponta-a-ponta seja complexo.

---

**IMPLEMENTAR:**
A refatoração dos endpoints secundários para a lógica de "dupla escrita".

**CURRENT STATE:**
Aproximadamente 10 endpoints, webhooks ou serviços ainda utilizam a lógica de `db.update(propostas).set({ status: ... })` diretamente, criando inconsistência.

**EXPECTED (Estado Final de Sucesso):**
**ZERO** ocorrências de `db.update(propostas).set({ status: ... })` restam na base de código. **TODA E QUALQUER** modificação no `status` de uma proposta é agora, sem exceção, manuseada pelo helper `updateStatusWithContext`.

**CONSTRAINTS (Roadmap de Implementação):**

**1. Auditoria e Mapeamento (Parte do seu Dry Run):**
    - **Ação:** Re-execute uma busca global para encontrar todos os pontos de modificação de status restantes.
    - **Relatório no Dry Run:** Apresente a lista final e completa de todos os ficheiros e funções que você irá refatorar nesta missão final.

**2. Refatoração Sistemática:**
    - **Ação:** Para cada local identificado, substitua a chamada de `update` direto pela chamada ao helper `updateStatusWithContext`.

---
**PROTOCOLO OBRIGATÓRIO 7-CHECK EXPANDIDO:**
Siga o protocolo completo. O critério de sucesso principal é uma **busca global final** que prove a ausência de qualquer modificação de status legada.
---
**DECLARAÇÃO DE INCERTEZA (OBRIGATÓRIO):**
Preencha a declaração completa, com foco especial no seu nível de confiança de que **nenhum** ponto de modificação de status foi esquecido.
---