Pacote de Ativação de Missão (PAM) V1.0 - Correção de Lógica de Negócio
Sumário da Missão: Corrigir a lógica de negócio no serviço de documentos, ajustando o tempo de expiração da URL de visualização para o valor correto de 7 dias.

Intenção Estratégica: Alinhar a implementação técnica com o requisito de negócio explícito para que as URLs de visualização de documentos tenham uma validade de uma semana, garantindo que os analistas tenham tempo suficiente para revisar os documentos sem que os links expirem prematuramente.

Histórico Relevante: A auditoria forense identificou que a função generateSignedUrl em server/services/documentsService.ts está a utilizar um valor de expiração incorreto (3600 segundos / 1 hora), em vez do valor requerido de 604800 segundos (7 dias).

Modelo Mental: Esta é uma correção cirúrgica num parâmetro de função. A alteração não afeta o fluxo de código, apenas o valor de um argumento, tornando a lógica de negócio consistente com a especificação.

Riscos Antecipados e Contramedidas: BAIXO. O risco é limitado a um erro de digitação no novo valor numérico. A contramedida é a revisão rigorosa do código modificado, conforme o protocolo 7-CHECK.

IMPLEMENTAR:
Ajustar o tempo de expiração na geração de URLs assinadas no serviço de documentos para 7 dias.

CURRENT STATE:

Ficheiro: server/services/documentsService.ts

Linha: 74 (aproximadamente)

Código com Falha:

TypeScript

const signedUrl = await this.documentsRepository.generateSignedUrl(filePath, 3600);
Evidência Bruta: O valor 3600 no segundo argumento da função generateSignedUrl faz com que as URLs expirem em apenas uma hora, o que viola a regra de negócio.

EXPECTED (Estado Final de Sucesso):

Ficheiro: server/services/documentsService.ts

Código Corrigido:

TypeScript

const signedUrl = await this.documentsRepository.generateSignedUrl(filePath, 604800); // 7 dias em segundos
Comportamento: Todas as novas URLs de visualização de documentos geradas pelo sistema serão válidas por exatamente 7 dias (604800 segundos).

DECLARAÇÃO DE INCERTEZA (OBRIGATÓRIO):

CONFIANÇA NA IMPLEMENTAÇÃO: 100%

RISCOS IDENTIFICADOS: BAIXO.

DECISÕES TÉCNICAS ASSUMIDAS: "Utilizando o valor em segundos (604800) diretamente, conforme a expectativa da API createSignedUrl do Supabase."

VALIDAÇÃO PENDENTE: "A validação funcional completa será realizada no Passo 4 do roadmap."

PROTOCOLO OBRIGATÓRIO 7-CHECK EXPANDIDO:

Mapeie o ficheiro exato a ser modificado: server/services/documentsService.ts.

Garanta que a única alteração é o valor numérico do segundo argumento da função generateSignedUrl.

Execute get_latest_lsp_diagnostics e corrija TODOS os erros ou avisos que a sua modificação possa ter introduzido.

Declare o seu Nível de Confiança (0-100%) na implementação.

Categorize quaisquer Riscos Descobertos (BAIXO/MÉDIO/ALTO/CRÍTICO).

Realize um teste funcional mínimo: confirme que a aplicação reinicia sem erros após a sua alteração.

Documente quaisquer Decisões Técnicas assumidas.