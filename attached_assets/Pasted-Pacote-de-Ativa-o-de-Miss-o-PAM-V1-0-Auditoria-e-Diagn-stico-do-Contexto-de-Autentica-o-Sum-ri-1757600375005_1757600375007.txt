Pacote de Ativação de Missão (PAM) V1.0 - Auditoria e Diagnóstico do Contexto de Autenticação
Sumário da Missão: Realizar uma auditoria forense em duas fases no componente de criação de propostas: primeiro, extrair o seu código-fonte completo para verificação ocular; segundo, injetar logs de diagnóstico para expor o conteúdo do objeto user que é fornecido pelo AuthContext.

Hipótese / Ponto de Falha: A lógica user?.role === 'ADMINISTRADOR' está a falhar porque o objeto user é nulo, não contém a propriedade role, ou o valor da role não corresponde exatamente à string "ADMINISTRADOR".

A SUA MISSÃO SERÁ EXECUTADA EM DUAS FASES:

FASE 1: AUDITORIA (Extração de Código-Fonte)

Extraia e apresente o conteúdo completo do ficheiro client/src/pages/nova-proposta.tsx (ou o ficheiro equivalente para a criação de propostas). O objetivo é que eu possa verificar o código real implementado.

Aguarde a minha análise do código antes de prosseguir para a Fase 2.

FASE 2: DIAGNÓSTICO (Injeção de Logs)

(Execute apenas após a minha confirmação)

Modifique o mesmo ficheiro (nova-proposta.tsx) para injetar o seguinte bloco de logs. O objetivo é vermos o conteúdo exato do objeto user que está a ser usado para a verificação da role.

Código de Diagnóstico a Injetar:

TypeScript

// Localize a linha onde o 'user' é obtido do 'useAuth()'
const { user } = useAuth();

// INJETE O SEGUINTE BLOCO DE DIAGNÓSTICO IMEDIATAMENTE APÓS
// --- INÍCIO DO BLOCO DE DIAGNÓSTICO OBRIGATÓRIO ---
console.log('--- DIAGNÓSTICO DE ROLE DE UTILIZADOR ---');
console.log('TIPO DO OBJETO user:', typeof user);
console.log('CONTEÚDO BRUTO DO user:', JSON.stringify(user, null, 2));
if (user) {
  console.log('CHAVES DISPONÍVEIS NO OBJETO user:', Object.keys(user));
  console.log('VALOR de user.role:', user.role);
} else {
  console.log('Objeto user é nulo ou indefinido na renderização.');
}
console.log('--- FIM DO DIAGNÓSTICO ---');
// --- FIM DO BLOCO DE DIAGNÓSTICO OBRIGATÓRIO ---

// A lógica de verificação de admin que se segue
const isAdmin = user?.role === 'ADMINISTRADOR';