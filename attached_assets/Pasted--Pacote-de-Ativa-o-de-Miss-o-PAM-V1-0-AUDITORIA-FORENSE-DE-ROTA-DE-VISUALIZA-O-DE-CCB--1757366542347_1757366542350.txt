### **Pacote de Ativação de Missão (PAM) V1.0 - AUDITORIA FORENSE DE ROTA DE VISUALIZAÇÃO DE CCB**

* **Sumário da Missão:** Realizar uma auditoria forense de ponta-a-ponta no fluxo de visualização de CCB a partir da tela de Formalização para identificar a causa raiz do erro "404 Page Not Found".

* **Cenário de Negócio (O "Caso de Teste"):** Um `ATENDENTE` na tela de Formalização (`/formalizacao/:id`) clica no botão "Ver CCB Gerada" ou "Baixar CCB". Em vez de o documento ser exibido ou o download ser iniciado, o usuário é redirecionado para uma página de erro 404.

* **Vetor de Ataque / Ponto de Falha (Hipóteses):**
    1.  **Rota de Frontend Inexistente (Hipótese Principal):** O `onClick` do botão está a tentar navegar para uma rota interna (ex: `/propostas/:id/documentos/ccb`) que não está definida no router principal da aplicação (`client/src/App.tsx`).
    2.  **Lógica de Geração de URL Incorreta:** A função que deveria gerar a URL assinada para o ficheiro no Supabase Storage está com defeito, resultando numa URL malformada que leva a um 404.
    3.  **Componente de Visualização Ausente/Defeituoso:** A rota existe, mas o componente que ela deveria renderizar (ex: `<CCBViewer />`) não está a ser importado ou utilizado corretamente.
    4.  **Endpoint de API Quebrado:** O botão aciona uma chamada a uma API intermediária para obter a URL do documento, e essa API está a falhar ou a devolver uma URL incorreta.

* **Evidência de Conformidade Requerida (A "Prova Irrefutável"):**

1.  **Análise do Componente de Frontend (`formalizacao.tsx`):**
    * Localize o ficheiro `client/src/pages/formalizacao.tsx`.
    * Identifique os componentes `<Button>` para "Ver CCB Gerada" e "Baixar CCB".
    * Apresente o código completo dos seus `onClick` handlers. Rastreie a função exata que eles chamam.

2.  **Análise da Lógica de Ação:**
    * Apresente o código da(s) função(ões) chamada(s) pelos botões. O que elas fazem? Elas usam `setLocation()` da `wouter` para uma rota interna, ou `window.open()` para uma URL externa?
    * Se for uma URL externa, mostre a lógica que constrói essa URL. Se for uma rota interna, anote o caminho exato.

3.  **Análise do Roteador Principal (`App.tsx`):**
    * Navegue até `client/src/App.tsx` (ou onde as rotas da aplicação são definidas).
    * Apresente a lista de todas as rotas (`<Route path="...">`) definidas.
    * Verifique se existe uma rota que corresponda ao padrão da rota que está a ser chamada pelo botão (identificada no passo 2).

4.  **Veredito Final:** Com base na análise completa, explique a causa raiz exata do erro 404. É uma rota de frontend em falta, uma URL mal construída, ou outro problema? Forneça um diagnóstico definitivo.