### **PACOTE DE ATIVAÇÃO DE MISSÃO (PAM) V1.0 - AUDITORIA FORENSE DE EMERGÊNCIA**

**ID da Missão:** `RCA-500-FORMALIZATION-001-AUDIT`

**Ferramenta Alocada:** `Sniper` (Assistente Replit)

**Sumário da Missão (O Quê):**
Capturar os logs de erro completos e o contexto de instanciação do `UseCase` relacionado ao endpoint `PATCH /api/propostas/:id/etapa-formalizacao` para diagnosticar a causa raiz de uma falha crítica "500 Internal Server Error". **NÃO MODIFIQUE NENHUM CÓDIGO.**

**Intenção Estratégica (O Porquê):**
Uma funcionalidade crítica está a causar uma falha fatal no servidor. Antes de qualquer tentativa de correção, é mandatório obter a "evidência bruta" (o stack trace do erro) do ambiente de execução. Esta evidência nos dirá exatamente qual linha de código está a falhar e porquê, permitindo uma correção cirúrgica.

---

#### **EVIDÊNCIA DE CONFORMIDADE REQUERIDA (A "PROVA IRREFUTÁVEL"):**

Responda aos seguintes pontos de investigação com precisão absoluta.

**Vetor 1: Captura de Evidência Bruta (Logs do Servidor)**

1.  **Reproduza a Falha e Capture os Logs:**
    * Execute o servidor.
    * Execute um comando `curl` (ou similar) que simule a chamada do frontend que está a falhar: `PATCH /api/propostas/ed2b393a-8bcc-4ef7-80da-419a26c79103/etapa-formalizacao` com um corpo JSON `{ "etapa": "assinatura_eletronica", "concluida": true }`.
    * Capture e apresente a **saída completa e literal do console do servidor** no momento em que o erro 500 ocorre. Estamos à procura do `stack trace` da exceção não tratada.

**Vetor 2: Análise do Ponto de Instanciação**

1.  **Contexto de Injeção de Dependência:**
    * Navegue até o arquivo `server/routes.ts`.
    * Apresente o trecho de código exato dentro do endpoint `PATCH /api/propostas/:id/etapa-formalizacao` onde o `MarcarAssinaturaConcluidaUseCase` é instanciado. Queremos ver como suas dependências estão a ser passadas para o construtor.

---

**ESTADO FINAL DE SUCESSO DA AUDITORIA:**
Você fornecerá um relatório contendo o `stack trace` completo do erro do servidor e o trecho de código da instanciação do `UseCase`. Esta informação é crítica para a nossa próxima ação.