2° - Desenvolvedor Full-Stack V10- Orquestrador de Refinamento de IA
Gem personalizado

Mostrar raciocínio
Arquiteto Chefe, "Blueprint Técnico" para o Sprint 2 recebido e assimilado.

Suas respostas estratégicas são claras, abrangentes e fornecem a intenção de comando necessária para arquitetar a próxima fase da "Operação Aço Líquido". A diretiva para focar no deploy com Supabase e postergar as abstrações de migração para Azure está anotada e será a nossa linha-mestra.

Com isto, a Fase 1: Alinhamento Estratégico do PDME para o Sprint 2 está formalmente concluída.

Avançamos para a Fase 3: Arquitetura da Solução. Com base no seu blueprint, projetei o "Roadmap de Implementação Faseado" para o Sprint 2. Este é o nosso plano de batalha técnico. Ele traduz suas decisões em user stories e technical tasks precisos, prontos para serem convertidos em Pacotes de Ativação de Missão (PAMs) para a equipe de execução.

Roadmap de Implementação Faseado - Sprint 2: Data Layer & Domain Model
Objetivo: Estabelecer a camada de persistência robusta (Drizzle) e modelar o domínio central (DDD), abstraindo a infraestrutura.
Status: Aguardando sua aprovação para iniciar a execução.

ÉPICO EP2-001: Camada de Persistência (Drizzle ORM) (21 Pontos)
User Story S2-001: Definir Schema Core e Migrações (8 Pontos, P0)

Tarefa 1.1: No ficheiro shared/schema.ts, modelar as entidades propostas, pagamentos, ccbs, e a nova entidade boletos.

Tarefa 1.2: Implementar a estratégia de Soft Deletes (campo deletedAt) como padrão para todas as entidades de negócio mencionadas.

Tarefa 1.3: Gerar o primeiro script de migração do Sprint 2 usando drizzle-kit, incluindo os índices mandatórios para propostas, pagamentos, ccbs, boletos e a otimização de soft deletes que você especificou.

User Story S2-002: Implementar Padrão Repository (8 Pontos, P1)

Tarefa 2.1: Criar as interfaces de repositório (ex: IProposalRepository) no nível do domínio (server/modules/proposal/domain/), definindo os métodos de CRUD básico e as queries de negócio específicas, incluindo findPendingByAnalyst, findReadyForCCBGeneration, e findAwaitingBoletoGeneration.

Tarefa 2.2: Implementar as classes concretas dos repositórios na camada de infraestrutura, utilizando Drizzle para construir as queries. Implementar a Paginação Baseada em Cursor para os métodos de listagem principal.

User Story S2-003: Implementar Unit of Work (Gestão de Transações) (5 Pontos, P1)

Tarefa 3.1: Criar um serviço UnitOfWork que encapsula as transações do Drizzle.

Tarefa 3.2: Refatorar os use cases que envolvem operações multi-agregado (ex: Aprovação de Proposta que gera CCB) para utilizar o UnitOfWork, garantindo a atomicidade das operações.

ÉPICO EP2-002: Modelagem de Domínio Core (DDD) (13 Pontos)
User Story S2-004: Modelar Domínio de Proposta e Crédito (13 Pontos, P0)

Tarefa 4.1: Desenvolver o Agregado Proposal (server/modules/proposal/domain/Proposal.ts).

Tarefa 4.2: Implementar as invariantes de negócio críticas dentro do Agregado, como a lógica de transição de estados (incluindo o novo estado PENDENCIADO) e a obrigatoriedade de motivo para rejeição/pendenciamento.

Tarefa 4.3: Implementar a emissão dos Domain Events essenciais (ex: ProposalApprovedEvent, ProposalPendingEvent) a partir do Agregado em cada mudança de estado relevante.

ÉPICO EP2-003: Abstrações e Dívida Técnica (P1) (12 Pontos)
User Story S2-005: Implementar Abstração de File Storage (5 Pontos, P2)

Tarefa 5.1: Definir a interface IStorageProvider com métodos como upload e getDownloadUrl.

Tarefa 5.2: Criar a implementação SupabaseStorageAdapter que satisfaça a interface.

Tarefa 5.3: Refatorar os serviços que interagem com o storage (ex: geração de CCB, download de boletos) para depender da abstração IStorageProvider, não da implementação concreta do Supabase.

User Story S2-006: Resolver Erros de Compilação TypeScript (DT-002) (7 Pontos, P1)

Tarefa 6.1: Levantar e categorizar os 47 erros de compilação remanescentes.

Tarefa 6.2: Executar um sprint de correção focado em zerar todos os erros de compilação, garantindo a conformidade com "strict": true.

Veredito do Arquiteto: Este roadmap é o plano de execução para o Sprint 2. Ele é tecnicamente sólido, alinhado com suas diretrizes estratégicas e prioriza as funcionalidades de maior impacto e risco.

Aguardando sua autorização final para começar a gerar os Pacotes de Ativação de Missão (PAMs) para a primeira User Story (S2-001).