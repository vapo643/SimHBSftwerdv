Lógica Completa de Permissões, Submissões e Conexões (v3.0 - Arquitetura Final)
Esta é a arquitetura de RBAC (Role-Based Access Control) e RLS (Row Level Security) que implementamos, agora com a doutrina de "Defesa em Profundidade":

No Frontend (UI): O menu de navegação é dinâmico e oculta os links para as funcionalidades que o usuário não tem permissão para aceder.

No Backend (API): Todas as rotas são protegidas por "guards" de permissão. Mesmo que um usuário tente aceder a uma funcionalidade diretamente pelo URL (slug), a API irá bloquear a requisição com um erro 403 Forbidden, garantindo que ele não consiga nem ver e nem agir sobre dados ou telas restritas.

1. O ATENDENTE
Contexto: Um ATENDENTE está sempre, e obrigatoriamente, debaixo da hierarquia de um Parceiro e de uma Loja. Todas as suas ações e visões de dados são filtradas por este contexto.

Função: A linha de frente do negócio. Responsável por originar as propostas de crédito.

Visão:

Dashboard (Tela Única): A sua tela principal e única é o Dashboard. Este painel é a sua central de trabalho, onde ele tem acesso a:

Suas Métricas: Gráficos e indicadores de performance mostrando apenas as suas próprias propostas (criadas hoje, na semana, no mês).

Suas Propostas: Uma lista/tabela com apenas as propostas que ele mesmo criou, em todos os status (aguardando análise, pendente, aprovado, negado, etc.). É a partir daqui que ele audita e analisa tudo.

Menus Restritos: Os menus para "Fila de Análise", "Pagamentos" e todas as "Configurações de Admin" (Usuários, Parceiros, Lojas, etc.) são totalmente invisíveis e inacessíveis (mesmo por URL) para ele.

Ações e Submissões:

Criar Nova Proposta: Pode aceder à tela T-01. O sistema utiliza o seu contexto de Parceiro e Loja para puxar as Tabelas Comerciais corretas.

Analisar/Corrigir Proposta: No seu Dashboard, ele pode clicar em "Analisar" numa proposta. Isto o levará para a tela de detalhes da proposta, onde ele pode ver o histórico e, se a proposta estiver com status pendente, ele pode corrigi-la e adicionar observações.

2. O ANALISTA
Contexto: O ANALISTA é uma entidade central da Simpix. Ele não está debaixo de nenhuma Loja ou Parceiro.

Função: O cérebro da operação de crédito. Responsável por avaliar o risco e tomar a decisão sobre as propostas.

Visão:

Tela Principal (Única): A sua tela principal, e a única funcionalidade que ele pode ver e aceder, é a "Fila de Análise".

Fila de Análise: Vê todas as propostas de todas as lojas que estão com os status aguardando_analise ou em_analise.

Menus Restritos: Os menus de "Dashboard", "Pagamentos" e todas as "Configurações de Admin" são totalmente invisíveis e inacessíveis (mesmo por URL) para ele.

Ações e Submissões:

Analisar Proposta: Pode abrir qualquer proposta da sua fila para ver todos os detalhes.

Tomar a Decisão: No "Painel de Decisão", pode Aprovar, Negar ou Pendenciar uma proposta.

(Outros Perfis: GERENTE, FINANCEIRO, ADMINISTRADOR - Permissões Inalteradas)
A Lógica Detalhada das Tabelas Comerciais
Este é o coração da nossa lógica de negócio, que dita quais produtos e condições um ATENDENTE pode oferecer.

A Ligação Fundamental: Toda Tabela Comercial está obrigatoriamente ligada a um ou mais Produtos.

As Tabelas Padrão:

São criadas pelo ADMINISTRADOR na tela de "Gestão de Tabelas Comerciais".

Podem ser associadas a vários produtos de uma só vez (a nossa nova UI de "tag input").

Têm uma taxa de juros e uma comissão padrão.

Não estão associadas a nenhum Parceiro específico.

As Tabelas Personalizadas:

São criadas pelo ADMINISTRADOR ou GERENTE na tela de "Detalhes do Parceiro".

Estão associadas a um Produto e a um Parceiro específico.

Têm a sua própria taxa de juros e comissão, que são personalizadas para aquele parceiro.

A Hierarquia de Conexão (O "Cérebro" do Sistema):

Quando um ATENDENTE (que pertence à "Loja A" do "Parceiro X") inicia uma "Nova Proposta" e seleciona um Produto (ex: "Empréstimo Pessoal"):
a. O sistema primeiro procura no banco de dados por uma tabela personalizada que corresponda à combinação exata de produto_id e parceiro_id ("Parceiro X").
b. SE ENCONTRAR, o dropdown de "Tabela Comercial" exibirá apenas essa(s) tabela(s) personalizada(s).
c. SE NÃO ENCONTRAR, o sistema então faz o "fallback" e busca por todas as tabelas padrão (onde parceiro_id é NULO) que estão associadas àquele Produto, exibindo-as no dropdown.

O Fluxo Comum do Software (A Jornada da Proposta v2.0)
Originação (Atendente): Um ATENDENTE submete uma "Nova Proposta" (T-01). A proposta é criada com o status aguardando_analise.

Fila de Análise (Analista): A nova proposta aparece na "Fila de Análise" (T-02) do ANALISTA.

Decisão (Analista): O ANALISTA abre o "Painel de Análise" (T-03) e Aprova, Nega ou Pendencia a proposta.

Ciclo de Correção (Atendente): Se pendenciada, a proposta aparece no Dashboard do ATENDENTE para correção.

Formalização (Atendente): Se aprovada, a proposta aparece na "Fila de Formalização" (T-04) do ATENDENTE.

Pagamento (Financeiro): Após a formalização, o status muda para pronto_pagamento e a proposta aparece na "Fila de Pagamento" (T-05).

Cobrança: Após o pagamento, a proposta entra no módulo de Cobrança.