### Pacote de Ativação de Missão (PAM) V1.0 - Operação "Velocidade de Escape" / Missão 2: Diagnóstico de Performance P95

* **Sumário da Missão (O Quê):** Realizar uma análise de performance estática aprofundada no "caminho crítico" do fluxo de autenticação e criação de propostas para identificar os estrangulamentos específicos que estão a causar a latência P95 de >1700ms. Com base na análise, propor um roadmap de otimização detalhado.
* **Intenção Estratégica (O Porquê):** Reduzir a latência da aplicação para cumprir o SLA de nível bancário (`P95 < 500ms`). Uma aplicação performática é essencial para a experiência do utilizador, a eficiência operacional e a escalabilidade do sistema.
* **Modelo Mental (Como se Encaixa):** Você é um engenheiro de performance sênior (SRE) a realizar uma análise de *profiling*. A sua tarefa é dissecar o fluxo de execução, medir o custo de cada operação e identificar os pontos de maior contenção para propor otimizações cirúrgicas.

---
### **DOUTRINA DE EXECUÇÃO OBRIGATÓRIA: PEO V2.0**

* **MODO DE OPERAÇÃO:** Esta missão é de análise e planejamento. Você operará em **MODO_PLANEJAMENTO**.
* **PERSONA:** Adote a persona de **"Arquiteto Documentador"**.
* **REGRAS DE ENGAJAMENTO:** A execução de código de remediação é **PROIBIDA**. O seu único entregável é um documento de análise e o plano de otimização.

---

**IMPLEMENTAR (Plano de Diagnóstico):**
Execute a seguinte sequência de análise.

**CURRENT STATE:**
O sistema está funcional, mas os testes de carga revelaram uma latência P95 de 1717ms, violando o SLA de 500ms. A causa exata do estrangulamento não é conhecida.

**EXPECTED (Estado Final da Análise):**
Um relatório de diagnóstico em Markdown que contenha:
1.  Uma análise detalhada da latência em cada etapa do fluxo (autenticação, validação de token, criação de proposta).
2.  A identificação da(s) causa(s) raiz da alta latência.
3.  Um roadmap de otimização faseado (P0, P1) com as ações de refatoração propostas para atingir o SLA.

**CONSTRAINTS (Roadmap de Diagnóstico):**

**Passo 1: Análise de Latência do Middleware JWT**
1.1. Abra o ficheiro `server/lib/jwt-auth-middleware.ts`.
1.2. Analise a lógica de validação do token. Preste especial atenção à chamada `await supabase.auth.getUser(token)`. Esta é uma chamada de rede a um serviço externo.
1.3. **Pergunta de Análise:** A utilização do cache Redis que implementámos na Missão 1 está a prevenir eficazmente chamadas repetidas a `supabase.auth.getUser(token)` para o mesmo token? Ou existem cenários em que o cache é contornado?

**Passo 2: Análise de Latência do `CreateProposalUseCase`**
2.1. Abra o ficheiro `server/modules/proposal/application/CreateProposalUseCase.ts`.
2.2. Analise o método `execute`. Identifique todas as operações `await` dentro da transação do `UnitOfWork`.
2.3. **Pergunta de Análise:** Existem operações de I/O (leituras da base de dados) desnecessárias ou redundantes antes da operação de escrita principal? A validação de `BusinessRuleValidator` executa queries adicionais?

**Passo 3: Propor o Roadmap de Otimização**
3.1. Com base na sua análise, crie um roadmap de remediação detalhado. Para cada otimização proposta, inclua:
    * **O Problema:** Descrição do estrangulamento.
    * **A Solução Proposta:** Descrição da alteração técnica.
    * **O Impacto Esperado:** Como a solução contribuirá para a redução da latência P95.

---

### **PROTOCOLO DE DIVULGAÇÃO TOTAL (PDT) V1.0 (MANDATÓRIO)**
Apresente a lista exaustiva de TODAS as suas descobertas, hipóteses e o roadmap de otimização.
---