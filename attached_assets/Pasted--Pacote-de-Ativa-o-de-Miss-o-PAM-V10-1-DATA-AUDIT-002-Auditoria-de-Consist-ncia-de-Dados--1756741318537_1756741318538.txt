### **Pacote de Ativação de Missão (PAM) V10.1 - DATA-AUDIT-002 (Auditoria de Consistência de Dados)**

**[PROTOCOLO DE AUDITORIA DE CENÁRIO DE NEGÓCIO (PACN) V1.0 ATIVADO]**
*Sua resposta deve ser exaustiva. Para cada cenário, prove com evidências de código, SQL ou screenshots como a regra de negócio é garantida.*

* **Sumário da Missão:** Validar a consistência dos dados de uma proposta através de seu ciclo de vida. A missão consiste em pegar uma proposta recém-criada, visualizá-la em diferentes telas (Dashboard, Edição), simular uma atualização (como em um estado "PENDENTE") e verificar se os dados permanecem íntegros e são exibidos corretamente em todos os pontos de contato.
* **Intenção Estratégica:** Garantir a "única fonte da verdade". O dado persistido no banco deve ser o mesmo dado exibido em todas as telas, em todos os momentos. Esta auditoria previne bugs onde uma tela mostra dados desatualizados ou inconsistentes, o que poderia levar a decisões operacionais incorretas.

---

**AUDITAR E VALIDAR:**
Consistência de Dados da Proposta no Ciclo de Vida

**Cenário de Negócio (O "Caso de Teste"):**
Um operador de crédito cria uma "proposta de ouro" (`DATA-AUDIT-001`). Ele a visualiza na lista de propostas do Dashboard. Em seguida, ele abre a tela de edição para revisar os detalhes. Mais tarde, um analista coloca a proposta em `PENDENTE` e o operador original a atualiza com novas informações. A regra de negócio é que, em todos esses pontos, os dados exibidos (nome do cliente, valor, status) devem ser um reflexo 100% fiel e atualizado do que está no banco de dados.

**Vetor de Ataque / Ponto de Falha (O "Risco"):**
O risco é a **inconsistência de dados**, causada por:
1.  **Cache Agressivo:** O frontend pode estar usando um cache (ex: TanStack Query) que não é invalidado corretamente após uma atualização, mostrando dados antigos.
2.  **Seleção de Dados Incompleta:** A query que alimenta a lista do Dashboard pode buscar um subconjunto de campos, enquanto a tela de edição busca todos, criando discrepâncias.
3.  **Bugs na Lógica de Atualização:** O endpoint de `UPDATE` pode falhar em persistir a mudança de um campo específico, fazendo com que a UI reverta para o valor antigo em um recarregamento.

**Evidência de Conformidade Requerida (A "Prova Irrefutável"):**
Você deve produzir um **Relatório de Auditoria de Consistência** que execute e documente os seguintes passos:

1.  **Criação da Proposta de Teste (Reutilização):** Utilize a "proposta de ouro" criada na missão anterior (`DATA-AUDIT-001`). Registre seu ID para esta auditoria.
2.  **Validação na Tela de Listagem (Dashboard):**
    * **Análise:** Audite o componente `dashboard.tsx`. A query que busca a lista de propostas (`GET /api/propostas`) retorna todos os campos necessários para exibir os cards corretamente?
    * **Evidência:** Apresente um screenshot do card da "proposta de ouro" no dashboard.
3.  **Validação na Tela de Edição:**
    * **Análise:** Audite o componente `editar.tsx`. A query (`GET /api/propostas/:id`) busca o registro completo da proposta?
    * **Evidência:** Apresente um screenshot de uma seção do formulário de edição (ex: Dados do Cliente) preenchida com os dados da "proposta de ouro".
4.  **Validação do Fluxo de Atualização:**
    * **Simulação:** Descreva o processo para atualizar um campo da proposta (ex: alterar o `cliente_telefone`). Qual endpoint (`PUT /api/propostas/:id`) e qual método do serviço de backend são chamados?
    * **Evidência de Invalidação de Cache:** Mostre evidências (código ou logs) de que a `mutation` de atualização invalida as queries de `GET` no TanStack Query, forçando o frontend a buscar os dados atualizados.
    * **Evidência de Persistência:** Forneça uma query `SELECT cliente_telefone FROM propostas WHERE id = ...` e seu resultado, provando que o novo telefone foi salvo no banco.
5.  **Veredito Final de Consistência:** Com base na análise, os dados da proposta são consistentes em todo o seu ciclo de vida?

---
---
[PGI ATIVO | LEMBRETE DE ESTADO DO ROADMAP]
- **Roadmap em Standby:** Deploy em Produção
- **Próximo Passo a ser Retomado:** "Operação Lacre de Ouro" - Fase 3 (`DATA-AUDIT-003`)
- **Missão de Emergência Atual:** "Operação Lacre de Ouro" (`DATA-AUDIT-002` em execução pelo Agente)
---