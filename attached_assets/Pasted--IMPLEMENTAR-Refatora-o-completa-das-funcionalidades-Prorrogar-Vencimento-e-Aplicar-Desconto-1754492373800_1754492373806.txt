**IMPLEMENTAR:** Refatoração completa das funcionalidades "Prorrogar Vencimento" e "Aplicar Desconto" na "Tela de Cobranças", transformando-as em fluxos de negócio inteligentes para gestão de quitação e parcelas.

**CONTEXT:** A implementação atual é básica. Precisamos de uma lógica de sistema robusta. "Aplicar Desconto" deve se tornar um fluxo de "Desconto para Quitação", que recalcula a dívida e substitui os boletos existentes por novos. "Prorrogar Vencimento" deve permitir a seleção de boletos específicos para alteração.

**CURRENT STATE:** A tela possui um menu de ações com botões de lógica simples, que não refletem a complexidade do processo de cobrança real.

**EXPECTED (Estado Final de Sucesso):**

**1. Fluxo de "Desconto para Quitação":**
    - **Interface (Modal Multi-etapas):**
        - **Etapa 1: Cálculo da Dívida.** Ao clicar em "Aplicar Desconto de Quitação", o modal deve primeiro exibir o "Valor Restante da Dívida". Este valor deve ser calculado no backend (Valor total da proposta - soma de todos os pagamentos já recebidos para essa proposta).
        - **Etapa 2: Aplicação do Desconto.** O usuário insere o `valor do desconto`. A UI calcula e exibe o "Novo Valor para Quitação".
        - **Etapa 3: Geração de Novas Parcelas.** O usuário seleciona em quantas parcelas (1, 2 ou 3) deseja dividir o "Novo Valor para Quitação". A interface deve exibir campos para o `valor` e a `data de vencimento` de cada nova parcela. Deve haver uma validação em tempo real para garantir que a soma das novas parcelas seja igual ao "Novo Valor para Quitação".
    - **Lógica de Backend (Transacional):**
        - **Ação Atômica:** Toda a operação deve ser envolvida em uma transação de banco de dados para garantir que ou tudo funciona, ou tudo é revertido.
        - **Passo A (Cancelamento):** Para a proposta em questão, identifique TODOS os boletos existentes e ativos na API do Inter. Use a função `cancelarCobranca` do `interBankService` para cada um deles.
        - **Passo B (Inativação Local):** Em nossa tabela `inter_collections`, atualize os registros dos boletos cancelados para `isActive: false`.
        - **Passo C (Criação de Novos Boletos):** Use a função `emitirCobranca` do `interBankService` para criar cada um dos novos boletos definidos pelo usuário.
        - **Passo D (Registro Local):** Salve os novos boletos na tabela `inter_collections`.
        - **Passo E (Auditoria):** Salve um registro na tabela `historico_observacoes_cobranca` (ver seção BANCO) com uma mensagem automática, ex: "Desconto de quitação de R$X,XX aplicado. Boletos antigos cancelados e substituídos por Y novas parcelas."

**2. Fluxo de "Prorrogar Vencimento":**
    - **Interface (Modal com Seleção):**
        - Ao clicar em "Prorrogar Vencimento", o modal deve listar TODOS os boletos ativos daquela proposta, cada um com uma `checkbox`.
        - O modal deve ter um único campo de seleção de data (`date picker`) para a `novaDataVencimento`.
    - **Lógica de Backend:**
        - Ao confirmar, o backend recebe a lista de `codigoSolicitacao` dos boletos selecionados e a `novaDataVencimento`.
        - Para cada `codigoSolicitacao` na lista, o backend deve chamar a função `editarCobranca` do `interBankService` para atualizar a data de vencimento na API do Inter.
        - Para cada sucesso, atualizar a `dataVencimento` correspondente em nossa tabela `inter_collections`.

**BANCO (Diretriz Crítica de Schema):**
- Esta missão requer uma nova tabela para auditoria. **Crie e aplique uma migração (Drizzle) para uma nova tabela chamada `historico_observacoes_cobranca`**. Ela deve conter no mínimo: `id`, `proposta_id` (foreign key para `propostas`), `mensagem` (text), `criado_por` (text, email do usuário logado), e `created_at` (timestamp).
- Analise a tabela `inter_collections` e adicione uma nova coluna `motivo_cancelamento` (text, nullable) para registrar por que um boleto foi inativado (ex: "Substituído por quitação").

**TESTE:**
1.  **Quitação:** Pegue uma proposta com boletos ativos. Execute o fluxo de quitação. Valide no dashboard do Banco Inter E no nosso banco de dados que os boletos antigos foram cancelados e os novos foram criados corretamente. Verifique se o log de auditoria foi salvo na nova tabela.
2.  **Prorrogação:** Pegue uma proposta com múltiplos boletos ativos. Selecione apenas alguns e prorrogue o vencimento. Valide que APENAS os boletos selecionados tiveram suas datas alteradas na API do Inter e em nosso banco.