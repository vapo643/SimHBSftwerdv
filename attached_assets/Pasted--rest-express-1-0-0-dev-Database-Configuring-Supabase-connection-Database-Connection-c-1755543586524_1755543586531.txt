
> rest-express@1.0.0 dev
‚úÖ Database: Configuring Supabase connection...
‚úÖ Database: Connection configured (lazy)
[CLICKSIGN V1] üöÄ Initialized in PRODUCTION mode (legal signatures)
[CLICKSIGN V1] API URL: https://app.clicksign.com/api/v1
[CLICKSIGN V1] Token configured: b73b3b90-c87...
[CLICKSIGN] üî¥ Circuit Breaker will be initialized on first use
[INTER] üè¶ Initialized in production mode
[INTER] üåê API URL: https://cdpj.partners.bancointer.com.br
[INTER] üî¥ Circuit Breakers will be initialized on first use
[CLICKSIGN V1] üöÄ Initialized in PRODUCTION mode (legal signatures)
[CLICKSIGN V1] API URL: https://app.clicksign.com/api/v1
[CLICKSIGN V1] Token configured: b73b3b90-c...
[DEV QUEUE] üì¶ Created development queue: pdf-processing
[DEV QUEUE] üì¶ Created development queue: boleto-sync
[DEV QUEUE] üì¶ Created development queue: document-processing
[DEV QUEUE] üì¶ Created development queue: notifications
[DEV QUEUE] üöÄ Development queues initialized with REAL worker processing
üöÄ [TIMING MIDDLEWARE] Creating middleware instance...
üöÄ [TIMING MIDDLEWARE] Middleware instance created and exported
6:57:44 PM [express] ‚úÖ All secrets loaded successfully
6:57:44 PM [express] üîí [SECURITY] CORS protection configured - ASVS V13.2.1
6:57:44 PM [express] üîí [SECURITY] OPTIONS preflight handling configured
6:57:44 PM [express] üîß [DEV] Using basic CSP configuration optimized for Vite development
6:57:44 PM [express] üîí [SECURITY] Input sanitization middleware activated
6:57:44 PM [express] üîí [SECURITY] URL token validation middleware activated - ASVS V7.1.1
6:57:44 PM [express] üîí [SECURITY] CSRF protection middleware activated - OWASP Cheat Sheet
6:57:44 PM [express] üîß [DEV] Rate limiting configurado para desenvolvimento - limites altos
[SEMGREP MCP] Development mode - using in-memory cache
üß† [ML] Treinando modelo de detec√ß√£o...
6:57:44 PM [express] üîê Security WebSocket initialized
[CCB SYNC] üöÄ Starting fallback polling (every 6 hours)
[CCB SYNC] ‚ÑπÔ∏è Primary processing via webhooks, polling is safety net only
6:57:44 PM [express] üîÑ CCB Sync Service initialized - Webhook primary, polling fallback every 6 hours
6:57:44 PM [express] üîî Sistema de Alertas Proativos inicializado - Pr√≥xima execu√ß√£o: 19/08/2025, 04:00:00
6:57:44 PM [express] ‚ÑπÔ∏è  Security monitoring disabled. Set ENABLE_SECURITY_MONITORING=true to enable
6:57:44 PM [express] üîß App Config Status:
6:57:44 PM [express]   - Port: 5000
6:57:44 PM [express]   - Environment: development
6:57:44 PM [express]   - Database: ‚úÖ Connected
6:57:44 PM [express]   - Supabase: ‚úÖ Connected
6:57:44 PM [express]   - Security: Rate Limit ‚úÖ, Helmet ‚úÖ
6:57:44 PM [express] üöÄ Server running on port 5000
6:57:44 PM [express] üåç Environment: development
6:57:44 PM [express] üì¶ Checking storage buckets...
6:57:46 PM [express] ‚úÖ Storage bucket "documents" already exists as PRIVATE
Browserslist: browsers data (caniuse-lite) is 10 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
‚úÖ [ML] Modelo treinado com 0 amostras
‚úÖ Database: Connection test successful
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /api/debug/me
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/pagamentos
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T18:58:31.958Z'
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /api/debug/me
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/api/documentos/download?path=ccb%2Fccb-902183dd-b5d1-4e20-8a72-79d3d3559d4d-1754073441226.pdf
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T18:58:32.601Z'
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /api/debug/me
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/pagamentos
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /notificacoes
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/pagamentos
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/pagamentos
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T18:58:52.645Z'
}
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T18:58:52.707Z'
}
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T18:58:52.845Z'
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /api/debug/me
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/pagamentos
[JWT DEBUG] Header Auth presente: true
[JWT DEBUG] Header come√ßa com Bearer: true
üîê JWT VALIDATION: {
  hasError: false,
  errorType: null,
  hasUser: true,
  userId: 'a65efc54-90cd-4b94-b971-c8a560104032',
  timestamp: '2025-08-18T18:58:53.772Z'
}
[ALERTAS] Mapeamento: gabrielserri238@gmail.com -> Local ID: 2
[ALERTAS] Encontradas 4 notifica√ß√µes, 0 n√£o lidas
[PAGAMENTOS DEBUG] Total propostas: 29
[PAGAMENTOS DEBUG] Propostas aprovadas: 1
[PAGAMENTOS DEBUG] Propostas com CCB assinada: 3
[PAGAMENTOS DEBUG] Propostas com boletos Inter: 2
[PAGAMENTOS DEBUG] Proposta com boleto Inter ID: 88a44696-9b63-42ee-aa81-15f9519d24cb
[PAGAMENTOS DEBUG] Status da proposta com boleto: {
  id: '88a44696-9b63-42ee-aa81-15f9519d24cb',
  status: 'BOLETOS_EMITIDOS',
  ccbGerado: true,
  assinaturaEletronicaConcluida: false,
  clienteNome: 'Gabriel Santana Jesus '
}
[PAGAMENTOS DEBUG] Propostas com status pronto_pagamento: 1
[PAGAMENTOS DEBUG] IDs: [ 'formal-test-001' ]
[PAGAMENTOS DEBUG] ========== AN√ÅLISE DE BOLETOS ==========
[PAGAMENTOS DEBUG] Encontradas 62 propostas com boletos
[PAGAMENTOS DEBUG] IDs v√°lidos de propostas: 62
[PAGAMENTOS DEBUG] Total de propostas com boletos Inter: 2
[PAGAMENTOS DEBUG] Proposta com boleto 1: {
  id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
  clienteNome: 'Gabriel de Jesus Santana Serri',
  status: 'BOLETOS_EMITIDOS',
  ccbGerado: true,
  assinaturaEletronicaConcluida: true
}
[PAGAMENTOS DEBUG] Proposta com boleto 2: {
  id: '88a44696-9b63-42ee-aa81-15f9519d24cb',
  clienteNome: 'Gabriel Santana Jesus ',
  status: 'BOLETOS_EMITIDOS',
  ccbGerado: true,
  assinaturaEletronicaConcluida: false
}
[PAGAMENTOS DEBUG] ========================================
[PAGAMENTOS SECURITY] Aplicando filtros cr√≠ticos de seguran√ßa para pagamentos - Status System V2.0
[PAGAMENTOS DEBUG] Total propostas encontradas: 2
[PAGAMENTOS DEBUG] Proposta 1: {
  id: '88a44696-9b63-42ee-aa81-15f9519d24cb',
  clienteNome: 'Gabriel Santana Jesus ',
  clienteCpf: '205.284.647-60',
  valorTotalFinanciado: '20000.00',
  valorTac: null,
  valorIof: null,
  status: 'BOLETOS_EMITIDOS',
  ccbGerado: true,
  assinaturaEletronicaConcluida: false,
  lojaNome: 'Loja Teste29',
  produtoNome: 'Fgts',
  dadosPagamentoBanco: '001',
  dadosPagamentoAgencia: '1234',
  dadosPagamentoConta: '56789'
}
[PAGAMENTOS DEBUG] Proposta 2: {
  id: '902183dd-b5d1-4e20-8a72-79d3d3559d4d',
  clienteNome: 'Gabriel de Jesus Santana Serri',
  clienteCpf: '20528464760',
  valorTotalFinanciado: '1000.00',
  valorTac: '50.00',
  valorIof: '150.00',
  status: 'BOLETOS_EMITIDOS',
  ccbGerado: true,
  assinaturaEletronicaConcluida: true,
  lojaNome: 'Inova',
  produtoNome: 'Emprestimo Pessoal',
  dadosPagamentoBanco: null,
  dadosPagamentoAgencia: null,
  dadosPagamentoConta: null
}
[PAGAMENTOS DEBUG] Processando proposta 88a44696-9b63-42ee-aa81-15f9519d24cb: {
  clienteNome: 'Gabriel Santana Jesus ',
  clienteCpf: '205.284.647-60',
  valorTotalFinanciado: '20000.00',
  lojaNome: 'Loja Teste29',
  produtoNome: 'Fgts'
}
[PAGAMENTOS DEBUG] Pagamento formatado para 88a44696-9b63-42ee-aa81-15f9519d24cb: {
  numeroContrato: 'CONT-88A44696',
  clienteNome: 'Gabriel Santana Jesus ',
  clienteCpf: '205.284.647-60',
  dadosPagamentoBanco: '001',
  valorFinanciado: 20000,
  valorLiquido: 20000,
  produto: 'Fgts',
  loja: 'Loja Teste29'
}
[PAGAMENTOS DEBUG] Processando proposta 902183dd-b5d1-4e20-8a72-79d3d3559d4d: {
  clienteNome: 'Gabriel de Jesus Santana Serri',
  clienteCpf: '20528464760',
  valorTotalFinanciado: '1000.00',
  lojaNome: 'Inova',
  produtoNome: 'Emprestimo Pessoal'
}
[PAGAMENTOS DEBUG] Pagamento formatado para 902183dd-b5d1-4e20-8a72-79d3d3559d4d: {
  numeroContrato: 'CONT-902183DD',
  clienteNome: 'Gabriel de Jesus Santana Serri',
  clienteCpf: '20528464760',
  dadosPagamentoBanco: 'N/A',
  valorFinanciado: 1000,
  valorLiquido: 800,
  produto: 'Emprestimo Pessoal',
  loja: 'Inova'
}
[PAGAMENTOS DEBUG] Pagamentos antes dos filtros: 2
[PAGAMENTOS DEBUG] Filtros recebidos - status: undefined, periodo: undefined
[PAGAMENTOS DEBUG] RESPOSTA FINAL: 2 pagamentos
[PAGAMENTOS DEBUG] Primeiro pagamento: {
  id: '88a44696-9b63-42ee-aa81-15f9519d24cb',
  clienteNome: 'Gabriel Santana Jesus ',
  status: 'em_processamento'
}
[JWT DEBUG] ==== IN√çCIO DA VALIDA√á√ÉO JWT ====
[JWT DEBUG] Rota acessada: /download
[JWT DEBUG] M√©todo: GET
[JWT DEBUG] User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
[JWT DEBUG] Origin: undefined
[JWT DEBUG] Referer: https://874e2dce-5057-49ae-8fb5-21491c9977ba-00-1xresvzm7is3g.janeway.replit.dev/financeiro/pagamentos
[JWT DEBUG] Header Auth presente: false
[JWT DEBUG] Header come√ßa com Bearer: undefined
‚ö†Ô∏è [SECURITY] TOKEN_INVALID | severity=MEDIUM | FAILURE | ip=187.36.168.240 | endpoint=/api/documentos/download?path=ccb%2Fccb-902183dd-b5d1-4e20-8a72-79d3d3559d4d-1754073441226.pdf
